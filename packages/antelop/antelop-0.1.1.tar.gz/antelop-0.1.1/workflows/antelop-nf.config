params {
    config_profile_description = 'The Antelop profile for the LMB cluster'
    config_profile_contact = 'Rory Bedford'
    config_profile_url = 'https://www.antelop.readthedocs.io/'
}

// cleanup = true

apptainer {
  enabled = true
  autoMounts = true
  runOptions = '--nv -B $SLURM_SCRATCH_DIR -B /cephfs/$USER/.antelop'
  envWhitelist = 'SLURM_CPUS_PER_TASK, SLURM_MEM_PER_NODE, SLURM_GPUS, SLURM_SCRATCH_DIR, DB_HOST, DB_USER, DB_PASS, S3_HOST, S3_USER, S3_PASS'
  libraryDir = "/public/singularity/containers/antelop/containers"
}

env {
    DB_HOST = "$DB_HOST"
    DB_USER = "$DB_USER"
    DB_PASS = "$DB_PASS"
    S3_HOST = "$S3_HOST"
    S3_USER = "$S3_USER"
    S3_PASS = "$S3_PASS"
}

process {
  executor = 'slurm'

  errorStrategy = 'ignore'
}

executor {
    submitRateLimit = '1sec'
    queueSize = 100
}

// fast scratch space for intermediate results
workDir = "/net/nfs1/netscr/${USER}/antelop"

// directory where phy results are published
params.phyDir = "/cephfs/${USER}/.antelop/phy" // be careful that you mount this correctly so the paths line up inside the container

notification {
    enabled = true
    to = "${USER}@mrc-lmb.cam.ac.uk"
}

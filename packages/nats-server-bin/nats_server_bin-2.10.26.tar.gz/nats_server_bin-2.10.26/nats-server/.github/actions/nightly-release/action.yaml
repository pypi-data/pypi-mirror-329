name: Nightly Docker Releaser
description: Builds nightly docker images

inputs:
  hub_username:
    description: Docker hub username
    required: true

  hub_password:
    description: Docker hub password
    required: true

  workdir:
    description: The working directory for actions requiring it
    required: true

runs:
  using: composite
  steps:
    - name: Log in to Docker Hub
      shell: bash
      run: docker login -u "${{ inputs.hub_username }}" -p "${{ inputs.hub_password }}"

    - name: Set up Go
      uses: actions/setup-go@v4
      with:
        go-version: "stable"

    - name: Build and push Docker images
      # Use commit hash here to avoid a re-tagging attack, as this is a third-party action
      # Commit 5742e2a039330cbb23ebf35f046f814d4c6ff811 = tag v5
      uses: goreleaser/goreleaser-action@5742e2a039330cbb23ebf35f046f814d4c6ff811
      with:
        workdir: "${{ inputs.workdir }}"
        version: ~> v2
        args: release --skip=announce,validate --config .goreleaser-nightly.yml

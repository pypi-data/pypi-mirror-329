{% extends "_layout.html" %}
{% block content %}
    <h2 class="h2">Workflow Status</h2>
    <div class="btn-toolbar mb-2 mb-md-0">

    </div>

    </div>

    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">

             {% if mode.casefold() == 'completed' %}
                        <a href="/workflow-completed-summary">All Completed</a>
                {% else %}
                    <a href="/workflow-running">All Running</a>
                {% endif %}

            </li>
        </ol>
    </nav>

    <h5>{{ config_json["datasource"] }} &nbsp; &nbsp;<button type="button" class="btn btn-primary btn-sm"
                                                             onclick="location.reload();">Refresh
    </button>
    </h5>
    <br/>
    <div class="table-responsive">
        <table class="table table-striped table-sm">

            <tbody>
            <tr>
                <td><b>Delivery Type</b></td>
                <td>{{ config_json["delivery_type"] }}</td>
            </tr>
            <tr>
                <td><b>Data Manager(s)</b></td>
                <td>{{ config_json["data_manager_email"] }}</td>
            </tr>
            <tr>
                <td><b>Target Database</b></td>
                <td>{{ config_json["target_database"] }}</td>
            </tr>
            <tr>
                <td><b>Workflow Id</b></td>
                <td>{{ config_json["workflow_id"] }}</td>
            </tr>
            <tr>
                <td><b>Delivery Date</b></td>
                <td>{{ config_json["delivery_date"] }}</td>
            </tr>
            <tr>
                <td><b>Vendor Delivery Location</b></td>
                <td>{{ config_json["vendor_delivery_location"] }}</td>
            </tr>
            <tr>
                <td><b>Workflow Status</b></td>
                <td>
                    {% if config_json["tracking"]["status"].casefold() == 'succeeded' %}
                        <i class="bi bi-check-circle " style="font-size: 1rem; color: green;"></i>
                    {% endif %}
                    {% if config_json["tracking"]["status"].casefold() == 'failed' %}
                        <i class="bi bi-x-circle " style="font-size: 1rem; color: red;"></i>
                    {% endif %}
                    {% if config_json["tracking"]["status"].casefold() == 'running' %}
                        <i class="bi bi-arrow-clockwise " style="font-size: 1rem; color: blue;"></i>
                    {% endif %}
                    {% if config_json["tracking"]["status"].casefold() == 'rejected' %}
                        <i class="bi bi-stop-circle" style="font-size: 1rem; color: red;"></i>
                    {% endif %}

                    {{ config_json["tracking"]["status"] }}</td>
            </tr>
            <tr>
                <td><b>Workflow Start (UTC)</b></td>
                <td>{{ config_json["tracking"]["start_utc"] }}</td>
            </tr>
            <tr>
                <td><b>Workflow End (UTC)</b></td>
                <td>{{ config_json["tracking"]["end_utc"] }}</td>
            </tr>
            </tbody>
        </table>
    </div>

    <hr/>
    <h6>Services</h6>
    <div class="accordion" id="accordionExample">
        {% for service in config_json["services"] %}
            <div class="accordion-item">
                <h2 class="accordion-header">

                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#collapse{{ loop.index }}">

                        <div style="display: table;width: 100%">
                            <div style="float: left;width: 80%">

                                {% if service["target_system"] == 'adb' %}
                                    <img src="/static/10787-icon-service-Azure-Databricks.svg" width="25"> &nbsp;
                                {% endif %}
                                {% if service["target_system"] == 'adf' %}
                                    <img src="/static/10126-icon-service-Data-Factories.svg" width="20"> &nbsp;
                                {% endif %}
                                {% if service["target_system"] == 'ala' %}
                                    <img src="/static/02631-icon-service-Logic-Apps.svg" width="25"> &nbsp;
                                {% endif %}

                                {{ service["display_name"] }}

                                {% if service.get("cluster_config") is not none %}
                                    &nbsp;&nbsp;&nbsp;
                                    <span class="badge bg-secondary">Custom Cluster Config</span>
                                {% endif %}
                                {% if service.get("schedule") is not none %}
                                    &nbsp;&nbsp;&nbsp;
                                    <span class="badge bg-secondary">Custom Schedule</span>
                                {% endif %}
                            </div>


                            <div style="float: right;width: 20%">
                                {% if service.get("tracking") is not none %}
                                    {% if service["tracking"]["status"].casefold() == 'succeeded' %}
                                        <i class="bi bi-check-circle " style="font-size: 1rem; color: green;"></i>
                                    {% endif %}
                                    {% if service["tracking"]["status"].casefold() == 'failed' %}
                                        <i class="bi bi-x-circle " style="font-size: 1rem; color: red;"></i>
                                    {% endif %}
                                    {% if service["tracking"]["status"].casefold() == 'running' %}
                                        <i class="bi bi-arrow-clockwise " style="font-size: 1rem; color: blue;"></i>
                                    {% endif %}
                                    {% if service["tracking"]["status"].casefold() == 'rejected' %}
                                        <i class="bi bi-stop-circle" style="font-size: 1rem; color: red;"></i>
                                    {% endif %}
                                    {% if service["tracking"]["status"].casefold() == 'pendingapproval' %}
                                        <i class="bi bi-arrow-clockwise " style="font-size: 1rem; color: blue;"></i>
                                    {% endif %}
                                    {% if service["tracking"]["status"].casefold() == 'pendingscheduleexpiration' %}
                                        <i class="bi bi-hourglass" style="font-size: 1rem; color: blue;"></i>
                                    {% endif %}
                                    {% if service["tracking"]["status"].casefold() == 'rerun' %}
                                        <i class="bi bi-arrow-clockwise " style="font-size: 1rem; color: blue;"></i>
                                    {% endif %}
                                    {{ service["tracking"]["status"] }}
                                {% endif %}

                            </div>

                        </div>


                    </button>
                </h2>
                <div id="collapse{{ loop.index }}" class="accordion-collapse collapse"
                     data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        <div style="text-align: center">
                            <strong>Service Name: {{ service["target_resource_name"] }}</strong></div>
                        <div class="table-responsive">
                            <table class="table table-striped table-sm caption-top">
                                <caption>Parameters</caption>
                                <thead>
                                <tr>
                                    <th scope="col">Name</th>
                                    <th scope="col">Value</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for param in service["parameters"].keys() %}
                                    <tr>
                                        <td>{{ param }}</td>
                                        <td>{{ service["parameters"][param] }}</td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% if service.get("cluster_config") is not none %}
                            <div class="table-responsive">
                                <table class="table table-striped table-sm caption-top">
                                    <caption>Cluster Configuration</caption>
                                    <tbody>
                                    {% for param in service["cluster_config"].keys() %}
                                        <tr>
                                            <td>{{ param }}</td>
                                            <td>{{ service["cluster_config"][param] }}</td>
                                        </tr>
                                    {% endfor %}

                                    </tbody>
                                </table>
                            </div>

                        {% endif %}

                        {% if service.get("schedule") is not none %}
                            <div class="table-responsive">
                                <table class="table table-striped table-sm caption-top">
                                    <caption>Schedule</caption>
                                    <tbody>
                                    {% for param in service["schedule"].keys() %}
                                        <tr>
                                            <td>{{ param }}</td>
                                            <td>{{ service["schedule"][param] }}</td>
                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>

                        {% endif %}

                        {% if service.get("tracking") is not none %}
                            <div class="table-responsive">
                                <table class="table table-striped table-sm caption-top">
                                    <caption>Tracking</caption>
                                    <thead>
                                    <tr>
                                        <th scope="col">Name</th>
                                        <th scope="col">Value</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% for param in service["tracking"].keys() %}
                                        <tr>
                                            <td>{{ param }}</td>
                                            <td>{{ service["tracking"][param] }}</td>
                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% endif %}

                    </div>
                </div>
            </div>
        {% endfor %}
    </div>

{% endblock %}
{% extends "_layout.html" %}

{% block content %}
    <h2 class="h2">Datasets Configuration</h2>
    <div class="btn-toolbar mb-2 mb-md-0">

        <select name="data_source" class="form-select form-select-lg" id="data_source"
                onchange="on_dataset_select_change()">
            <option value="">Select a dataset</option>
            {% for dataset in datasets %}
                {% if selected_dataset == dataset %}
                    <option value="{{ dataset }}" selected>{{ dataset }}</option>
                {% else %}
                    <option value="{{ dataset }}">{{ dataset }}</option>
                {% endif %}

            {% endfor %}

        </select>

    </div>

    </div>


    <h5>{{ config_json["datasource"] }}</h5>
    <br/>
    <div class="table-responsive">
        <table class="table table-striped table-sm">

            <tbody>
            <tr>
                <td><b>Delivery Type</b></td>
                <td>{{ config_json["delivery_type"] }}</td>
            </tr>
            <tr>
                <td><b>Data Manager(s)</b></td>
                <td>{{ config_json["data_manager_email"] }}</td>
            </tr>
            <tr>
                <td><b>Target Database</b></td>
                <td>{{ config_json["target_database"] }}</td>
            </tr>

            </tbody>
        </table>
    </div>

    <hr/>
    <h6>Services</h6>
    <div class="accordion" id="accordionExample">
        {% for service in config_json["services"] %}
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#collapse{{ loop.index }}">
                        {% if service["target_system"] == 'adb' %}
                            <img src="/static/10787-icon-service-Azure-Databricks.svg" width="25"> &nbsp;
                        {% endif %}
                        {% if service["target_system"] == 'adf' %}
                            <img src="/static/10126-icon-service-Data-Factories.svg" width="20"> &nbsp;
                        {% endif %}
                        {% if service["target_system"] == 'ala' %}
                            <img src="/static/02631-icon-service-Logic-Apps.svg" width="25"> &nbsp;
                        {% endif %}

                        {{ service["display_name"] }}

                        {% if service.get("cluster_config") is not none %}
                            &nbsp;&nbsp;&nbsp;
                            <span class="badge bg-secondary">Custom Cluster Config</span>
                        {% endif %}
                        {% if service.get("schedule") is not none %}
                            &nbsp;&nbsp;&nbsp;
                            <span class="badge bg-secondary">Custom Schedule</span>
                        {% endif %}
                    </button>
                </h2>
                <div id="collapse{{ loop.index }}" class="accordion-collapse collapse"
                     data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        <strong>{{ service["target_resource_name"] }}</strong>
                        <div class="table-responsive">
                            <table class="table table-striped table-sm caption-top">
                                <caption>Parameters</caption>
                                <thead>
                                <tr>
                                    <th scope="col">Name</th>
                                    <th scope="col">Value</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for param in service["parameters"].keys() %}
                                    <tr>
                                        <td>{{ param }}</td>
                                        <td>{{ service["parameters"][param] }}</td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% if service.get("cluster_config") is not none %}
                            <div class="table-responsive">
                                <table class="table table-striped table-sm caption-top">
                                    <caption>Cluster Configuration</caption>
                                    <tbody>
                                    {% for param in service["cluster_config"].keys() %}
                                        <tr>
                                            <td>{{ param }}</td>
                                            <td>{{ service["cluster_config"][param] }}</td>
                                        </tr>
                                    {% endfor %}

                                    </tbody>
                                </table>
                            </div>

                        {% endif %}

                        {% if service.get("schedule") is not none %}
                            <div class="table-responsive">
                                <table class="table table-striped table-sm caption-top">
                                    <caption>Schedule</caption>
                                    <tbody>
                                    {% for param in service["schedule"].keys() %}
                                        <tr>
                                            <td>{{ param }}</td>
                                            <td>{{ service["schedule"][param] }}</td>
                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>

                        {% endif %}
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>

    <script>
        function on_dataset_select_change() {
            const dataset = document.getElementById("data_source").value;
            const url = window.location.href.split('?')[0]
            window.location.href = url + "?data_source=" + dataset;
        }
    </script>

{% endblock %}



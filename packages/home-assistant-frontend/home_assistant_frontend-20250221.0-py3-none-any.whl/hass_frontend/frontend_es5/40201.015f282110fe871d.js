"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["40201"],{50875:function(e,t,r){r.d(t,{Eu:()=>i,hZ:()=>n,o9:()=>d});var a=r(27486),o=r(11259);const s=["#4269d0","#f4bd4a","#ff725c","#6cc5b0","#a463f2","#ff8ab7","#9c6b4e","#97bbf5","#01ab63","#9498a0","#094bad","#c99000","#d84f3e","#49a28f","#048732","#d96895","#8043ce","#7599d1","#7a4c31","#74787f","#6989f4","#ffd444","#ff957c","#8fe9d3","#62cc71","#ffadda","#c884ff","#badeff","#bf8b6d","#b6bac2","#927acc","#97ee3f","#bf3947","#9f5b00","#f48758","#8caed6","#f2b94f","#eff26e","#e43872","#d9b100","#9d7a00","#698cff","#d9d9d9","#00d27e","#d06800","#009f82","#c49200","#cbe8ff","#fecddf","#c27eb6","#8cd2ce","#c4b8d9","#f883b0","#a49100","#f48800","#27d0df","#a04a9b"];function i(e){return s[e%s.length]}function n(e,t){const r=t.getPropertyValue(`--graph-color-${e+1}`)||i(e);return(0,o.Rq)(r)}const d=(0,a.Z)((e=>s.map(((t,r)=>n(r,e)))),((e,t)=>e[0].getPropertyValue("--graph-color-1")===t[0].getPropertyValue("--graph-color-1")))},6736:function(e,t,r){r.d(t,{f:()=>i});var a=r(61701),o=r(72621),s=(r(19083),r(71695),r(40251),r(61006),r(39527),r(36993),r(47021),r(50778));const i=e=>(0,a.Z)(null,(function(e,t){class r extends t{constructor(...t){super(...t),e(this)}}return{F:r,d:[{kind:"field",decorators:[(0,s.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value:void 0},{kind:"field",key:"__unsubs",value:void 0},{kind:"method",key:"connectedCallback",value:function(){(0,o.Z)(r,"connectedCallback",this,3)([]),this._checkSubscribed()}},{kind:"method",key:"disconnectedCallback",value:function(){if((0,o.Z)(r,"disconnectedCallback",this,3)([]),this.__unsubs){for(;this.__unsubs.length;){const e=this.__unsubs.pop();e instanceof Promise?e.then((e=>e())):e()}this.__unsubs=void 0}}},{kind:"method",key:"updated",value:function(e){if((0,o.Z)(r,"updated",this,3)([e]),e.has("hass"))this._checkSubscribed();else if(this.hassSubscribeRequiredHostProps)for(const t of e.keys())if(this.hassSubscribeRequiredHostProps.includes(t))return void this._checkSubscribed()}},{kind:"method",key:"hassSubscribe",value:function(){return[]}},{kind:"method",key:"_checkSubscribed",value:function(){var e;void 0!==this.__unsubs||!this.isConnected||void 0===this.hass||null!==(e=this.hassSubscribeRequiredHostProps)&&void 0!==e&&e.some((e=>void 0===this[e]))||(this.__unsubs=this.hassSubscribe())}}]}}),e)},20548:function(e,t,r){r.d(t,{H:()=>s});r(81804);var a=r(11259),o=r(4643);function s(e,t,r,s,i,n){const d=e.getPropertyValue(i+"-"+n).trim(),c=d.length>0?d:e.getPropertyValue(i).trim();let l=(0,a.Rq)(c);return 0===d.length&&n&&(l=(0,a.CO)((0,a.p3)(t?(0,o.C)((0,a.Rw)((0,a.wK)(l)),n):(0,o.W)((0,a.Rw)((0,a.wK)(l)),n)))),s?l+=r?"32":"7F":r&&(l+="7F"),l}},53259:function(e,t,r){r.a(e,(async function(e,a){try{r.d(t,{J:()=>k,MC:()=>m,Zx:()=>j,b4:()=>p,kT:()=>O});r(28457),r(71695),r(92745),r(61893),r(5509),r(19423),r(92519),r(42179),r(89256),r(24931),r(88463),r(57449),r(19814),r(88044),r(39527),r(99790),r(41360),r(13334),r(47021);var o=r(21893),s=r(13809),i=r(38836),n=r(84775),d=r(80951),c=r(13730),l=r(6542),u=r(83204),f=r(23459),h=r(23711),b=r(50602),_=r(46467),g=r(33570),v=e([_,g,b]);function m(e,t){let r=new Date(t);return e>2&&0===r.getHours()&&(r=(0,o.b)(r,1)),r.setMinutes(0,0,0),e>35&&r.setDate(1),e>2&&r.setHours(0),r.getTime()}function p(e){return e>35?"month":e>2?"day":"hour"}function k(e,t,r,a,o,i,n,d){const c=(0,s.j)(t,e),l=void 0!==i&&void 0!==n;return{xAxis:{type:"time",min:e,max:m(c,t)},yAxis:{type:"value",name:o,nameGap:2,nameTextStyle:{align:"left"},axisLabel:{formatter:e=>(0,b.uf)(Math.abs(e),r)},splitLine:{show:!0}},grid:{top:15,bottom:0,left:1,right:1,containLabel:!0},tooltip:{trigger:"axis",formatter:e=>{if(Array.isArray(e)){const t=[],s=[];return e.forEach((e=>{var r;null!==(r=e.seriesId)&&void 0!==r&&r.startsWith("compare-")?s.push(e):t.push(e)})),[t,s].map((e=>S(e,r,a,c,l,o,d))).filter(Boolean).join("<br><br>")}return S([e],r,a,c,l,o,d)}}}}function S(e,t,r,a,o,s,n){var d,c,l,u;if(null===(d=e[0])||void 0===d||!d.value)return"";const f=new Date(null!==(c=null===(l=e[0].value)||void 0===l?void 0:l[2])&&void 0!==c?c:null===(u=e[0].value)||void 0===u?void 0:u[0]);let h;h=a>89?`${(0,_.NC)(f,t,r)}`:a>0?`${(0,_.ud)(f,t,r)}`:`${o?`${(0,_.ud)(f,t,r)}: `:""}${(0,g.mr)(f,t,r)} â€“ ${(0,g.mr)((0,i.T)(f,1),t,r)}`;const v=`<h4 style="text-align: center; margin: 0;">${h}</h4>`;let y=0,m=0,p=0,k=0;const S=e.map((e=>{var r;const a=null===(r=e.value)||void 0===r?void 0:r[1],o=(0,b.uf)(a,t);return"0"!==o&&("bar"===e.componentSubType&&(a>0?(y+=a,m++):(p+=a,k++)),`${e.marker} ${e.seriesName}: ${o} ${s}`)})).filter(Boolean);let j="";return 0!==y&&m>1&&n&&(j+=`<br><b>${n(y)}</b>`),0!==p&&k>1&&n&&(j+=`<br><b>${n(p)}</b>`),S.length>0?`${v}${S.join("<br>")}${j}`:""}function j(e){Array.from(new Set(e.map((e=>e.data.map((e=>Number(e[0]))))).flat())).sort(((e,t)=>e-t)).forEach(((t,r)=>{const a={},o={};for(let u=e.length-1;u>=0;u--){var s,i,n,d,c;const f=e[u].data[r],h=f&&"object"==typeof f&&"value"in f?f:{value:f},b=null===(s=h.value)||void 0===s?void 0:s[0],_=null!==(i=e[u].stack)&&void 0!==i?i:"";var l;if(void 0!==b)if(Number(b)!==t)null===(l=e[u].data)||void 0===l||l.splice(r,0,{value:[t,0],itemStyle:{borderWidth:0}});else 0===(null===(n=h.value)||void 0===n?void 0:n[1])?e[u].data[r]=Object.assign(Object.assign({},h),{},{itemStyle:Object.assign(Object.assign({},h.itemStyle),{},{borderWidth:0})}):!a[_]&&(null===(d=h.value)||void 0===d?void 0:d[1])>0?(e[u].data[r]=Object.assign(Object.assign({},h),{},{itemStyle:Object.assign(Object.assign({},h.itemStyle),{},{borderRadius:[4,4,0,0]})}),a[_]=!0):!o[_]&&(null===(c=h.value)||void 0===c?void 0:c[1])<0&&(e[u].data[r]=Object.assign(Object.assign({},h),{},{itemStyle:Object.assign(Object.assign({},h.itemStyle),{},{borderRadius:[0,0,4,4]})}),o[_]=!0)}}))}function O(e,t){if(!t)return e=>e;const r=(0,n.o)(e,t);if(0!==r&&e.getTime()===(0,d.e)(e).getTime())return e=>(0,c.B)(e,r);const a=(0,l.d)(e,t);if(0!==a&&e.getTime()===(0,u.N)(e).getTime())return e=>(0,f.z)(e,a);const o=e.getTime()-t.getTime();return e=>(0,h.n)(e,o)}[_,g,b]=v.then?(await v)():v,a()}catch(y){a(y)}}))},32672:function(e,t,r){r.a(e,(async function(e,a){try{r.r(t),r.d(t,{HuiEnergyUsageGraphCard:()=>C});var o=r(61701),s=(r(19083),r(71695),r(92745),r(61893),r(19423),r(40251),r(92519),r(42179),r(89256),r(24931),r(88463),r(57449),r(19814),r(39527),r(41360),r(36993),r(47021),r(42625)),i=r(83389),n=r(16444),d=r(57243),c=r(50778),l=r(35359),u=r(27486),f=r(20548),h=r(50602),b=r(25179),_=(r(54977),r(1118)),g=r(17705),v=r(6736),y=r(93331),m=r(53259),p=e([b,_,h,m]);[b,_,h,m]=p.then?(await p)():p;let k,S,j,O,$=e=>e;const x={to_grid:"--energy-grid-return-color",to_battery:"--energy-battery-in-color",from_grid:"--energy-grid-consumption-color",used_grid:"--energy-grid-consumption-color",used_solar:"--energy-solar-color",used_battery:"--energy-battery-out-color"};let C=(0,o.Z)([(0,c.Mo)("hui-energy-usage-graph-card")],(function(e,t){return{F:class extends t{constructor(...t){super(...t),e(this)}},d:[{kind:"field",decorators:[(0,c.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,c.SB)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,c.SB)()],key:"_chartData",value(){return[]}},{kind:"field",decorators:[(0,c.SB)()],key:"_start",value(){return(0,s.I)()}},{kind:"field",decorators:[(0,c.SB)()],key:"_end",value(){return(0,i.p)()}},{kind:"field",decorators:[(0,c.SB)()],key:"_compareStart",value:void 0},{kind:"field",decorators:[(0,c.SB)()],key:"_compareEnd",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value(){return["_config"]}},{kind:"method",key:"hassSubscribe",value:function(){var e;return[(0,_.UB)(this.hass,{key:null===(e=this._config)||void 0===e?void 0:e.collection_key}).subscribe((e=>this._getStatistics(e)))]}},{kind:"method",key:"getCardSize",value:function(){return 3}},{kind:"method",key:"setConfig",value:function(e){this._config=e}},{kind:"method",key:"shouldUpdate",value:function(e){return(0,y.SN)(this,e)||e.size>1||!e.has("hass")}},{kind:"method",key:"render",value:function(){return this.hass&&this._config?(0,d.dy)(k||(k=$` <ha-card> ${0} <div class="content ${0}"> <ha-chart-base .hass="${0}" .data="${0}" .options="${0}" chart-type="bar"></ha-chart-base> ${0} </div> </ha-card> `),this._config.title?(0,d.dy)(S||(S=$`<h1 class="card-header">${0}</h1>`),this._config.title):"",(0,l.$)({"has-header":!!this._config.title}),this.hass,this._chartData,this._createOptions(this._start,this._end,this.hass.locale,this.hass.config,this._compareStart,this._compareEnd),this._chartData.some((e=>e.data.length))?"":(0,d.dy)(j||(j=$`<div class="no-data"> ${0} </div>`),(0,n.z)(this._start)?this.hass.localize("ui.panel.lovelace.cards.energy.no_data"):this.hass.localize("ui.panel.lovelace.cards.energy.no_data_period"))):d.Ld}},{kind:"field",key:"_formatTotal",value(){return e=>e>0?this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.total_consumed",{num:(0,h.uf)(e,this.hass.locale)}):this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.total_returned",{num:(0,h.uf)(-e,this.hass.locale)})}},{kind:"field",key:"_createOptions",value(){return(0,u.Z)(((e,t,r,a,o,s)=>{const i=(0,m.J)(e,t,r,a,"kWh",o,s,this._formatTotal);return Object.assign(Object.assign({},i),{},{tooltip:Object.assign(Object.assign({},i.tooltip),{},{formatter:e=>{var t,r;return Array.isArray(e)?(e.sort(((e,t)=>{var r,a;const o=null===(r=e.value)||void 0===r?void 0:r[1],s=null===(a=t.value)||void 0===a?void 0:a[1];return o>0&&s<0?-1:s>0&&o<0?1:o>0?t.componentIndex-e.componentIndex:e.componentIndex-t.componentIndex})),null===(t=i.tooltip)||void 0===t||null===(r=t.formatter)||void 0===r?void 0:r.call(t,e)):""}})})}))}},{kind:"method",key:"_getStatistics",value:async function(e){const t=[],r={};for(const i of e.prefs.energy_sources)if("solar"!==i.type)if("battery"!==i.type){if("grid"===i.type){for(const e of i.flow_from)r.from_grid?r.from_grid.push(e.stat_energy_from):r.from_grid=[e.stat_energy_from];for(const e of i.flow_to)r.to_grid?r.to_grid.push(e.stat_energy_to):r.to_grid=[e.stat_energy_to]}}else r.to_battery?(r.to_battery.push(i.stat_energy_to),r.from_battery.push(i.stat_energy_from)):(r.to_battery=[i.stat_energy_to],r.from_battery=[i.stat_energy_from]);else r.solar?r.solar.push(i.stat_energy_from):r.solar=[i.stat_energy_from];const a=getComputedStyle(this),o={};Object.keys(x).forEach((e=>{o[e]={},"used_grid"!==e&&"used_solar"!==e&&"used_battery"!==e&&r[e]&&Object.values(r[e]).forEach(((t,r)=>{o[e][t]=r}))}));const s={used_grid:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.combined_from_grid"),used_solar:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.consumed_solar"),used_battery:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.consumed_battery")};if(this._start=e.start,this._end=e.end||(0,i.p)(),this._compareStart=e.startCompare,this._compareEnd=e.endCompare,e.statsCompare)t.push(...this._processDataSet(e.statsCompare,e.statsMetadata,r,o,a,s,!0));else{var n,d;const e=null!==(n=null===(d=r.from_grid)||void 0===d?void 0:d[0])&&void 0!==n?n:"placeholder";t.push({id:"compare-"+e,type:"bar",stack:"usage",data:[],order:0})}t.push(...this._processDataSet(e.stats,e.statsMetadata,r,o,a,s,!1)),t.sort(((e,t)=>e.order-t.order)),(0,m.Zx)(t),this._chartData=t}},{kind:"method",key:"_processDataSet",value:function(e,t,r,a,o,s,i=!1){const n=[],d={},c={};Object.entries(r).forEach((([t,r])=>{const a=["solar","to_grid","from_grid","to_battery","from_battery"].includes(t),o=!["solar","from_battery"].includes(t),s={},i={};r.forEach((t=>{const r=e[t];if(!r)return;const n={};r.forEach((e=>{if(null===e.change||void 0===e.change)return;const t=e.change;a&&(s[e.start]=e.start in s?s[e.start]+t:t),o&&!(e.start in n)&&(n[e.start]=t)})),i[t]=n})),a&&(c[t]=s),o&&(d[t]=i)}));const l={},u={};if((c.to_grid||c.to_battery)&&c.solar){const e={};for(const t of Object.keys(c.solar)){var h,b;if(e[t]=(c.solar[t]||0)-((null===(h=c.to_grid)||void 0===h?void 0:h[t])||0)-((null===(b=c.to_battery)||void 0===b?void 0:b[t])||0),e[t]<0){var _,v,y;if(c.to_battery)if(l[t]=-1*e[t],l[t]>((null===(_=c.from_grid)||void 0===_?void 0:_[t])||0))u[t]=l[t]-((null===(v=c.from_grid)||void 0===v?void 0:v[t])||0),l[t]=null===(y=c.from_grid)||void 0===y?void 0:y[t];e[t]=0}}d.used_solar={used_solar:e}}if(c.from_battery)if(c.to_grid){const e={};for(const t of Object.keys(c.from_battery))e[t]=(c.from_battery[t]||0)-(u[t]||0);d.used_battery={used_battery:e}}else d.used_battery={used_battery:c.from_battery};if(d.from_grid&&c.to_battery){const e={};for(const t of Object.keys(l)){let r,a=0;for(const[e,o]of Object.entries(d.from_grid))if(o[t]&&(r=e,a++),a>1)break;if(1===a)d.from_grid[r][t]-=l[t]||0;else{let r=0;Object.values(d.from_grid).forEach((e=>{r+=e[t]||0,delete e[t]})),e[t]=r-(l[t]||0)}}d.used_grid={used_grid:e}}let p=[];Object.values(d).forEach((e=>{Object.values(e).forEach((e=>{p=p.concat(Object.keys(e))}))}));const k=Array.from(new Set(p)).sort(((e,t)=>Number(e)-Number(t))),S=(0,m.kT)(this._start,this._compareStart);return Object.entries(d).forEach((([e,r],c)=>{Object.entries(r).forEach((([r,l])=>{var u,h;const b=[];for(const t of k){const r=l[t]||0,a=[Number(t),r&&["to_grid","to_battery"].includes(e)?-1*r:r];i&&(a[2]=a[0],a[0]=S(a[0])),b.push(a)}n.push({id:i?"compare-"+r:r,type:"bar",cursor:"default",name:e in s?s[e]:(0,g.Kd)(this.hass,r,t[r]),order:"used_solar"===e?1:"to_battery"===e?Object.keys(d).length:c+2,barMaxWidth:50,itemStyle:{borderColor:(0,f.H)(o,this.hass.themes.darkMode,!1,i,x[e],null===(u=a[e])||void 0===u?void 0:u[r])},color:(0,f.H)(o,this.hass.themes.darkMode,!0,i,x[e],null===(h=a[e])||void 0===h?void 0:h[r]),stack:i?"compare":"usage",data:b})}))})),n}},{kind:"field",static:!0,key:"styles",value(){return(0,d.iv)(O||(O=$`ha-card{height:100%}.card-header{padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}.no-data{position:absolute;height:100%;top:0;left:0;right:0;display:flex;justify-content:center;align-items:center;padding:20%;margin-left:32px;margin-inline-start:32px;margin-inline-end:initial;box-sizing:border-box}`))}}]}}),(0,v.f)(d.oi));a()}catch(k){a(k)}}))},41924:function(e,t,r){r.d(t,{y:()=>o});var a=r(53907);function o(e){return(0,a.L)(e,Date.now())}},5376:function(e,t,r){r.d(t,{X:()=>i});var a=r(34151),o=r(76808),s=r(14276);function i(e,t,r){const i=(0,s._)(e,t)/o.yJ;return(0,a.u)(null==r?void 0:r.roundingMethod)(i)}},83389:function(e,t,r){r.d(t,{p:()=>o});var a=r(96500);function o(e){return(0,a.i)(Date.now(),e)}},97836:function(e,t,r){r.d(t,{K:()=>s});r(71695),r(47021);var a=r(18492),o=r(7591);function s(e,t,r){const[s,i]=(0,a.d)(null==r?void 0:r.in,e,t);return+(0,o.b)(s)==+(0,o.b)(i)}},16444:function(e,t,r){r.d(t,{z:()=>i});var a=r(53907),o=r(41924),s=r(97836);function i(e,t){return(0,s.K)((0,a.L)((null==t?void 0:t.in)||e,e),(0,o.y)((null==t?void 0:t.in)||e))}},42625:function(e,t,r){r.d(t,{I:()=>o});var a=r(7591);function o(e){return(0,a.b)(Date.now(),e)}}}]);
//# sourceMappingURL=40201.015f282110fe871d.js.map
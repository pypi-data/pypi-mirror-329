"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["75034"],{50875:function(e,t,s){s.d(t,{Eu:()=>o,hZ:()=>r,o9:()=>c});var i=s(27486),a=s(11259);const n=["#4269d0","#f4bd4a","#ff725c","#6cc5b0","#a463f2","#ff8ab7","#9c6b4e","#97bbf5","#01ab63","#9498a0","#094bad","#c99000","#d84f3e","#49a28f","#048732","#d96895","#8043ce","#7599d1","#7a4c31","#74787f","#6989f4","#ffd444","#ff957c","#8fe9d3","#62cc71","#ffadda","#c884ff","#badeff","#bf8b6d","#b6bac2","#927acc","#97ee3f","#bf3947","#9f5b00","#f48758","#8caed6","#f2b94f","#eff26e","#e43872","#d9b100","#9d7a00","#698cff","#d9d9d9","#00d27e","#d06800","#009f82","#c49200","#cbe8ff","#fecddf","#c27eb6","#8cd2ce","#c4b8d9","#f883b0","#a49100","#f48800","#27d0df","#a04a9b"];function o(e){return n[e%n.length]}function r(e,t){const s=t.getPropertyValue(`--graph-color-${e+1}`)||o(e);return(0,a.Rq)(s)}const c=(0,i.Z)((e=>n.map(((t,s)=>r(s,e)))),((e,t)=>e[0].getPropertyValue("--graph-color-1")===t[0].getPropertyValue("--graph-color-1")))},68958:function(e,t,s){s.d(t,{t:()=>n});s(92745),s(77439),s(19423),s(39527),s(41360),s(88972);class i{constructor(e=window.localStorage){this.storage=void 0,this._storage={},this._listeners={},this.storage=e,e===window.localStorage&&window.addEventListener("storage",(e=>{e.key&&this.hasKey(e.key)&&(this._storage[e.key]=e.newValue?JSON.parse(e.newValue):e.newValue,this._listeners[e.key]&&this._listeners[e.key].forEach((t=>t(e.oldValue?JSON.parse(e.oldValue):e.oldValue,this._storage[e.key]))))}))}addFromStorage(e){if(!this._storage[e]){const t=this.storage.getItem(e);t&&(this._storage[e]=JSON.parse(t))}}subscribeChanges(e,t){return this._listeners[e]?this._listeners[e].push(t):this._listeners[e]=[t],()=>{this.unsubscribeChanges(e,t)}}unsubscribeChanges(e,t){if(!(e in this._listeners))return;const s=this._listeners[e].indexOf(t);-1!==s&&this._listeners[e].splice(s,1)}hasKey(e){return e in this._storage}getValue(e){return this._storage[e]}setValue(e,t){const s=this._storage[e];this._storage[e]=t;try{void 0===t?this.storage.removeItem(e):this.storage.setItem(e,JSON.stringify(t))}catch(i){}finally{this._listeners[e]&&this._listeners[e].forEach((e=>e(s,t)))}}}const a={},n=e=>t=>{const s=e.storage||"localStorage";let n;s&&s in a?n=a[s]:(n=new i(window[s]),a[s]=n);const o=String(t.key),r=e.key||String(t.key),c=t.initializer?t.initializer():void 0;n.addFromStorage(r);const d=!1!==e.subscribe?e=>n.subscribeChanges(r,((s,i)=>{e.requestUpdate(t.key,s)})):void 0,u=()=>n.hasKey(r)?e.deserializer?e.deserializer(n.getValue(r)):n.getValue(r):c;return{kind:"method",placement:"prototype",key:t.key,descriptor:{set(s){((s,i)=>{let a;e.state&&(a=u()),n.setValue(r,e.serializer?e.serializer(i):i),e.state&&s.requestUpdate(t.key,a)})(this,s)},get(){return u()},enumerable:!0,configurable:!0},finisher(s){if(e.state&&e.subscribe){const e=s.prototype.connectedCallback,t=s.prototype.disconnectedCallback;s.prototype.connectedCallback=function(){e.call(this),this[`__unbsubLocalStorage${o}`]=null==d?void 0:d(this)},s.prototype.disconnectedCallback=function(){var e;t.call(this),null===(e=this[`__unbsubLocalStorage${o}`])||void 0===e||e.call(this),this[`__unbsubLocalStorage${o}`]=void 0}}e.state&&s.createProperty(t.key,Object.assign({noAccessor:!0},e.stateOptions))}}}},6736:function(e,t,s){s.d(t,{f:()=>o});var i=s(61701),a=s(72621),n=(s(19083),s(71695),s(40251),s(61006),s(39527),s(36993),s(47021),s(50778));const o=e=>(0,i.Z)(null,(function(e,t){class s extends t{constructor(...t){super(...t),e(this)}}return{F:s,d:[{kind:"field",decorators:[(0,n.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value:void 0},{kind:"field",key:"__unsubs",value:void 0},{kind:"method",key:"connectedCallback",value:function(){(0,a.Z)(s,"connectedCallback",this,3)([]),this._checkSubscribed()}},{kind:"method",key:"disconnectedCallback",value:function(){if((0,a.Z)(s,"disconnectedCallback",this,3)([]),this.__unsubs){for(;this.__unsubs.length;){const e=this.__unsubs.pop();e instanceof Promise?e.then((e=>e())):e()}this.__unsubs=void 0}}},{kind:"method",key:"updated",value:function(e){if((0,a.Z)(s,"updated",this,3)([e]),e.has("hass"))this._checkSubscribed();else if(this.hassSubscribeRequiredHostProps)for(const t of e.keys())if(this.hassSubscribeRequiredHostProps.includes(t))return void this._checkSubscribed()}},{kind:"method",key:"hassSubscribe",value:function(){return[]}},{kind:"method",key:"_checkSubscribed",value:function(){var e;void 0!==this.__unsubs||!this.isConnected||void 0===this.hass||null!==(e=this.hassSubscribeRequiredHostProps)&&void 0!==e&&e.some((e=>void 0===this[e]))||(this.__unsubs=this.hassSubscribe())}}]}}),e)},20548:function(e,t,s){s.d(t,{H:()=>n});s(81804);var i=s(11259),a=s(4643);function n(e,t,s,n,o,r){const c=e.getPropertyValue(o+"-"+r).trim(),d=c.length>0?c:e.getPropertyValue(o).trim();let u=(0,i.Rq)(d);return 0===c.length&&r&&(u=(0,i.CO)((0,i.p3)(t?(0,a.C)((0,i.Rw)((0,i.wK)(u)),r):(0,a.W)((0,i.Rw)((0,i.wK)(u)),r)))),n?u+=s?"32":"7F":s&&(u+="7F"),u}},53259:function(e,t,s){s.a(e,(async function(e,i){try{s.d(t,{J:()=>y,MC:()=>g,Zx:()=>$,b4:()=>k,kT:()=>C});s(28457),s(71695),s(92745),s(61893),s(5509),s(19423),s(92519),s(42179),s(89256),s(24931),s(88463),s(57449),s(19814),s(88044),s(39527),s(99790),s(41360),s(13334),s(47021);var a=s(21893),n=s(13809),o=s(38836),r=s(84775),c=s(80951),d=s(13730),u=s(6542),l=s(83204),h=s(23459),f=s(23711),p=s(50602),b=s(46467),m=s(33570),v=e([b,m,p]);function g(e,t){let s=new Date(t);return e>2&&0===s.getHours()&&(s=(0,a.b)(s,1)),s.setMinutes(0,0,0),e>35&&s.setDate(1),e>2&&s.setHours(0),s.getTime()}function k(e){return e>35?"month":e>2?"day":"hour"}function y(e,t,s,i,a,o,r,c){const d=(0,n.j)(t,e),u=void 0!==o&&void 0!==r;return{xAxis:{type:"time",min:e,max:g(d,t)},yAxis:{type:"value",name:a,nameGap:2,nameTextStyle:{align:"left"},axisLabel:{formatter:e=>(0,p.uf)(Math.abs(e),s)},splitLine:{show:!0}},grid:{top:15,bottom:0,left:1,right:1,containLabel:!0},tooltip:{trigger:"axis",formatter:e=>{if(Array.isArray(e)){const t=[],n=[];return e.forEach((e=>{var s;null!==(s=e.seriesId)&&void 0!==s&&s.startsWith("compare-")?n.push(e):t.push(e)})),[t,n].map((e=>S(e,s,i,d,u,a,c))).filter(Boolean).join("<br><br>")}return S([e],s,i,d,u,a,c)}}}}function S(e,t,s,i,a,n,r){var c,d,u,l;if(null===(c=e[0])||void 0===c||!c.value)return"";const h=new Date(null!==(d=null===(u=e[0].value)||void 0===u?void 0:u[2])&&void 0!==d?d:null===(l=e[0].value)||void 0===l?void 0:l[0]);let f;f=i>89?`${(0,b.NC)(h,t,s)}`:i>0?`${(0,b.ud)(h,t,s)}`:`${a?`${(0,b.ud)(h,t,s)}: `:""}${(0,m.mr)(h,t,s)} â€“ ${(0,m.mr)((0,o.T)(h,1),t,s)}`;const v=`<h4 style="text-align: center; margin: 0;">${f}</h4>`;let _=0,g=0,k=0,y=0;const S=e.map((e=>{var s;const i=null===(s=e.value)||void 0===s?void 0:s[1],a=(0,p.uf)(i,t);return"0"!==a&&("bar"===e.componentSubType&&(i>0?(_+=i,g++):(k+=i,y++)),`${e.marker} ${e.seriesName}: ${a} ${n}`)})).filter(Boolean);let $="";return 0!==_&&g>1&&r&&($+=`<br><b>${r(_)}</b>`),0!==k&&y>1&&r&&($+=`<br><b>${r(k)}</b>`),S.length>0?`${v}${S.join("<br>")}${$}`:""}function $(e){Array.from(new Set(e.map((e=>e.data.map((e=>Number(e[0]))))).flat())).sort(((e,t)=>e-t)).forEach(((t,s)=>{const i={},a={};for(let l=e.length-1;l>=0;l--){var n,o,r,c,d;const h=e[l].data[s],f=h&&"object"==typeof h&&"value"in h?h:{value:h},p=null===(n=f.value)||void 0===n?void 0:n[0],b=null!==(o=e[l].stack)&&void 0!==o?o:"";var u;if(void 0!==p)if(Number(p)!==t)null===(u=e[l].data)||void 0===u||u.splice(s,0,{value:[t,0],itemStyle:{borderWidth:0}});else 0===(null===(r=f.value)||void 0===r?void 0:r[1])?e[l].data[s]=Object.assign(Object.assign({},f),{},{itemStyle:Object.assign(Object.assign({},f.itemStyle),{},{borderWidth:0})}):!i[b]&&(null===(c=f.value)||void 0===c?void 0:c[1])>0?(e[l].data[s]=Object.assign(Object.assign({},f),{},{itemStyle:Object.assign(Object.assign({},f.itemStyle),{},{borderRadius:[4,4,0,0]})}),i[b]=!0):!a[b]&&(null===(d=f.value)||void 0===d?void 0:d[1])<0&&(e[l].data[s]=Object.assign(Object.assign({},f),{},{itemStyle:Object.assign(Object.assign({},f.itemStyle),{},{borderRadius:[0,0,4,4]})}),a[b]=!0)}}))}function C(e,t){if(!t)return e=>e;const s=(0,r.o)(e,t);if(0!==s&&e.getTime()===(0,c.e)(e).getTime())return e=>(0,d.B)(e,s);const i=(0,u.d)(e,t);if(0!==i&&e.getTime()===(0,l.N)(e).getTime())return e=>(0,h.z)(e,i);const a=e.getTime()-t.getTime();return e=>(0,f.n)(e,a)}[b,m,p]=v.then?(await v)():v,i()}catch(_){i(_)}}))},36681:function(e,t,s){s.a(e,(async function(e,i){try{s.r(t),s.d(t,{HuiEnergyDevicesDetailGraphCard:()=>x});var a=s(61701),n=(s(71695),s(92745),s(52805),s(61893),s(19423),s(19134),s(97003),s(39527),s(99790),s(41360),s(13334),s(34595),s(47021),s(42625)),o=s(83389),r=s(57243),c=s(50778),d=s(35359),u=s(27486),l=s(50875),h=s(20548),f=(s(54977),s(25179)),p=s(1118),b=s(17705),m=s(6736),v=s(93331),_=s(53259),g=s(68958),k=s(50602),y=e([f,k,p,_]);[f,k,p,_]=y.then?(await y)():y;let S,$,C,w=e=>e;const O="kWh";let x=(0,a.Z)([(0,c.Mo)("hui-energy-devices-detail-graph-card")],(function(e,t){return{F:class extends t{constructor(...t){super(...t),e(this)}},d:[{kind:"field",decorators:[(0,c.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,c.SB)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,c.SB)()],key:"_chartData",value(){return[]}},{kind:"field",decorators:[(0,c.SB)()],key:"_data",value:void 0},{kind:"field",decorators:[(0,c.SB)()],key:"_start",value(){return(0,n.I)()}},{kind:"field",decorators:[(0,c.SB)()],key:"_end",value(){return(0,o.p)()}},{kind:"field",decorators:[(0,c.SB)()],key:"_compareStart",value:void 0},{kind:"field",decorators:[(0,c.SB)()],key:"_compareEnd",value:void 0},{kind:"field",decorators:[(0,g.t)({key:"energy-devices-hidden-stats",state:!0,subscribe:!1})],key:"_hiddenStats",value(){return[]}},{kind:"field",key:"hassSubscribeRequiredHostProps",value(){return["_config"]}},{kind:"method",key:"hassSubscribe",value:function(){var e;return[(0,p.UB)(this.hass,{key:null===(e=this._config)||void 0===e?void 0:e.collection_key}).subscribe((e=>{this._data=e,this._processStatistics()}))]}},{kind:"method",key:"getCardSize",value:function(){return 3}},{kind:"method",key:"setConfig",value:function(e){this._config=e}},{kind:"method",key:"shouldUpdate",value:function(e){return(0,v.SN)(this,e)||e.size>1||!e.has("hass")}},{kind:"method",key:"willUpdate",value:function(e){(e.has("_hiddenStats")||e.has("_config"))&&this._data&&this._processStatistics()}},{kind:"method",key:"render",value:function(){return this.hass&&this._config?(0,r.dy)(S||(S=w` <ha-card> ${0} <div class="content ${0}"> <ha-chart-base external-hidden .hass="${0}" .data="${0}" .options="${0}" @dataset-hidden="${0}" @dataset-unhidden="${0}"></ha-chart-base> </div> </ha-card> `),this._config.title?(0,r.dy)($||($=w`<h1 class="card-header">${0}</h1>`),this._config.title):"",(0,d.$)({"has-header":!!this._config.title}),this.hass,this._chartData,this._createOptions(this._start,this._end,this.hass.locale,this.hass.config,O,this._compareStart,this._compareEnd),this._datasetHidden,this._datasetUnhidden):r.Ld}},{kind:"field",key:"_formatTotal",value(){return e=>this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.total_consumed",{num:(0,k.uf)(e,this.hass.locale),unit:O})}},{kind:"method",key:"_datasetHidden",value:function(e){this._hiddenStats=[...this._hiddenStats,e.detail.name]}},{kind:"method",key:"_datasetUnhidden",value:function(e){this._hiddenStats=this._hiddenStats.filter((t=>t!==e.detail.name))}},{kind:"field",key:"_createOptions",value(){return(0,u.Z)(((e,t,s,i,a,n,o)=>{const r=(0,_.J)(e,t,s,i,a,n,o,this._formatTotal);return Object.assign(Object.assign({},r),{},{legend:{show:!0,type:"scroll",animationDurationUpdate:400,selected:this._hiddenStats.reduce(((e,t)=>(e[t]=!1,e)),{}),icon:"circle"},grid:{top:45,bottom:0,left:1,right:1,containLabel:!0}})}))}},{kind:"method",key:"_processStatistics",value:function(){const e=this._data;this._start=e.start,this._end=e.end||(0,o.p)(),this._compareStart=e.startCompare,this._compareEnd=e.endCompare;const t=e.stats,s=e.statsCompare,i=getComputedStyle(this),a={};e.prefs.device_consumption.forEach((e=>{const s=e.stat_consumption in t&&(0,b.Kj)(t[e.stat_consumption])||0;a[e.stat_consumption]=s}));const n=e.prefs.device_consumption.map((e=>e.stat_consumption));n.sort(((e,t)=>a[t]-a[e]));const r=[],{summedData:c,compareSummedData:d}=(0,p.EH)(e),u="from_grid"in c||"solar"in c||"from_battery"in c,{consumption:l,compareConsumption:h}=u?(0,p.E4)(c,d):{consumption:void 0,compareConsumption:void 0};if(s){const t=this._processDataSet(i,s,e.statsMetadata,e.prefs.device_consumption,n,!0);if(r.push(...t),u){const e=this._processUntracked(i,t,h,!0);r.push(e)}}else{var f,m;const t=null!==(f=null===(m=e.prefs.device_consumption[0])||void 0===m?void 0:m.stat_consumption)&&void 0!==f?f:"untracked";r.push({id:"compare-"+t,type:"bar",stack:"devices",data:[]})}const v=this._processDataSet(i,t,e.statsMetadata,e.prefs.device_consumption,n);if(r.push(...v),u){const e=this._processUntracked(i,v,l,!1);r.push(e)}(0,_.Zx)(r),this._chartData=r}},{kind:"method",key:"_processUntracked",value:function(e,t,s,i){const a={};t.forEach((e=>{e.data.forEach((e=>{a[e[i?2:0]]=(a[e[i?2:0]]||0)+e[1]}))}));const n=(0,_.kT)(this._start,this._compareStart),o=[];Object.keys(s.total).forEach((e=>{const t=Number(e),r=[t,s.total[e]-(a[e]||0)];i&&(r[2]=r[0],r[0]=n(new Date(t)).getTime()),o.push(r)}));const r=Date.now();return{type:"bar",cursor:"default",id:i?`compare-untracked-${r}`:`untracked-${r}`,name:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_detail_graph.untracked_consumption"),itemStyle:{borderColor:(0,h.H)(e,this.hass.themes.darkMode,!1,i,"--state-unavailable-color")},barMaxWidth:50,color:(0,h.H)(e,this.hass.themes.darkMode,!0,i,"--state-unavailable-color"),data:o,stack:i?"devicesCompare":"devices"}}},{kind:"method",key:"_processDataSet",value:function(e,t,s,i,a,n=!1){const o=[],r=(0,_.kT)(this._start,this._compareStart);return i.forEach(((i,c)=>{var d;const u=a.indexOf(i.stat_consumption);if(null!==(d=this._config)&&void 0!==d&&d.max_devices&&u>=this._config.max_devices)return void console.warn(`Max devices exceeded for ${i.name} (${u} >= ${this._config.max_devices})`);const h=(0,l.hZ)(c,e);let f=null;const p=[];if(i.stat_consumption in t){const e=t[i.stat_consumption];for(const t of e){if(null===t.change||void 0===t.change||0===t.change)continue;if(f===t.start)continue;const e=[t.start,t.change];n&&(e[2]=e[0],e[0]=r(new Date(t.start)).getTime()),p.push(e),f=t.start}}o.push({type:"bar",cursor:"default",id:n?`compare-${i.stat_consumption}-${u}`:`${i.stat_consumption}-${u}`,name:i.name||(0,b.Kd)(this.hass,i.stat_consumption,s[i.stat_consumption]),itemStyle:{borderColor:n?h+"7F":h},barMaxWidth:50,color:n?h+"32":h+"7F",data:p,stack:n?"devicesCompare":"devices"})})),a.map((e=>o.find((t=>t.id.replace(/^compare-/,"").replace(/-\d+$/,"")===e)))).filter(Boolean)}},{kind:"field",static:!0,key:"styles",value(){return(0,r.iv)(C||(C=w`.card-header{padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}`))}}]}}),(0,m.f)(r.oi));i()}catch(S){i(S)}}))},5376:function(e,t,s){s.d(t,{X:()=>o});var i=s(34151),a=s(76808),n=s(14276);function o(e,t,s){const o=(0,n._)(e,t)/a.yJ;return(0,i.u)(null==s?void 0:s.roundingMethod)(o)}},83389:function(e,t,s){s.d(t,{p:()=>a});var i=s(96500);function a(e){return(0,i.i)(Date.now(),e)}},42625:function(e,t,s){s.d(t,{I:()=>a});var i=s(7591);function a(e){return(0,i.b)(Date.now(),e)}}}]);
//# sourceMappingURL=75034.cb9c389a52823e1b.js.map
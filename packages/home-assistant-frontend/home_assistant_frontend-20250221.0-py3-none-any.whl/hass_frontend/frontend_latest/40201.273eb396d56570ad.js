export const ids=["40201"];export const modules={50875:function(e,t,r){r.d(t,{Eu:()=>n,hZ:()=>i,o9:()=>c});var a=r(27486),o=r(11259);const s=["#4269d0","#f4bd4a","#ff725c","#6cc5b0","#a463f2","#ff8ab7","#9c6b4e","#97bbf5","#01ab63","#9498a0","#094bad","#c99000","#d84f3e","#49a28f","#048732","#d96895","#8043ce","#7599d1","#7a4c31","#74787f","#6989f4","#ffd444","#ff957c","#8fe9d3","#62cc71","#ffadda","#c884ff","#badeff","#bf8b6d","#b6bac2","#927acc","#97ee3f","#bf3947","#9f5b00","#f48758","#8caed6","#f2b94f","#eff26e","#e43872","#d9b100","#9d7a00","#698cff","#d9d9d9","#00d27e","#d06800","#009f82","#c49200","#cbe8ff","#fecddf","#c27eb6","#8cd2ce","#c4b8d9","#f883b0","#a49100","#f48800","#27d0df","#a04a9b"];function n(e){return s[e%s.length]}function i(e,t){const r=t.getPropertyValue(`--graph-color-${e+1}`)||n(e);return(0,o.Rq)(r)}const c=(0,a.Z)((e=>s.map(((t,r)=>i(r,e)))),((e,t)=>e[0].getPropertyValue("--graph-color-1")===t[0].getPropertyValue("--graph-color-1")))},6736:function(e,t,r){r.d(t,{f:()=>n});var a=r(44249),o=r(72621),s=(r(39527),r(36993),r(15093));const n=e=>(0,a.Z)(null,(function(e,t){class r extends t{constructor(...t){super(...t),e(this)}}return{F:r,d:[{kind:"field",decorators:[(0,s.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value:void 0},{kind:"field",key:"__unsubs",value:void 0},{kind:"method",key:"connectedCallback",value:function(){(0,o.Z)(r,"connectedCallback",this,3)([]),this._checkSubscribed()}},{kind:"method",key:"disconnectedCallback",value:function(){if((0,o.Z)(r,"disconnectedCallback",this,3)([]),this.__unsubs){for(;this.__unsubs.length;){const e=this.__unsubs.pop();e instanceof Promise?e.then((e=>e())):e()}this.__unsubs=void 0}}},{kind:"method",key:"updated",value:function(e){if((0,o.Z)(r,"updated",this,3)([e]),e.has("hass"))this._checkSubscribed();else if(this.hassSubscribeRequiredHostProps)for(const t of e.keys())if(this.hassSubscribeRequiredHostProps.includes(t))return void this._checkSubscribed()}},{kind:"method",key:"hassSubscribe",value:function(){return[]}},{kind:"method",key:"_checkSubscribed",value:function(){void 0===this.__unsubs&&this.isConnected&&void 0!==this.hass&&!this.hassSubscribeRequiredHostProps?.some((e=>void 0===this[e]))&&(this.__unsubs=this.hassSubscribe())}}]}}),e)},20548:function(e,t,r){r.d(t,{H:()=>s});var a=r(11259),o=r(4643);function s(e,t,r,s,n,i){const c=e.getPropertyValue(n+"-"+i).trim(),d=c.length>0?c:e.getPropertyValue(n).trim();let u=(0,a.Rq)(d);return 0===c.length&&i&&(u=(0,a.CO)((0,a.p3)(t?(0,o.C)((0,a.Rw)((0,a.wK)(u)),i):(0,o.W)((0,a.Rw)((0,a.wK)(u)),i)))),s?u+=r?"32":"7F":r&&(u+="7F"),u}},53259:function(e,t,r){r.a(e,(async function(e,a){try{r.d(t,{J:()=>v,MC:()=>m,Zx:()=>S,b4:()=>p,kT:()=>$});r(92745),r(92519),r(42179),r(89256),r(24931),r(88463),r(57449),r(19814),r(39527),r(99790),r(41360),r(13334);var o=r(21893),s=r(13809),n=r(38836),i=r(84775),c=r(80951),d=r(13730),u=r(6542),l=r(83204),f=r(23459),h=r(23711),_=r(50602),b=r(46467),y=r(33570),g=e([b,y,_]);function m(e,t){let r=new Date(t);return e>2&&0===r.getHours()&&(r=(0,o.b)(r,1)),r.setMinutes(0,0,0),e>35&&r.setDate(1),e>2&&r.setHours(0),r.getTime()}function p(e){return e>35?"month":e>2?"day":"hour"}function v(e,t,r,a,o,n,i,c){const d=(0,s.j)(t,e),u=void 0!==n&&void 0!==i;return{xAxis:{type:"time",min:e,max:m(d,t)},yAxis:{type:"value",name:o,nameGap:2,nameTextStyle:{align:"left"},axisLabel:{formatter:e=>(0,_.uf)(Math.abs(e),r)},splitLine:{show:!0}},grid:{top:15,bottom:0,left:1,right:1,containLabel:!0},tooltip:{trigger:"axis",formatter:e=>{if(Array.isArray(e)){const t=[],s=[];return e.forEach((e=>{e.seriesId?.startsWith("compare-")?s.push(e):t.push(e)})),[t,s].map((e=>k(e,r,a,d,u,o,c))).filter(Boolean).join("<br><br>")}return k([e],r,a,d,u,o,c)}}}}function k(e,t,r,a,o,s,i){if(!e[0]?.value)return"";const c=new Date(e[0].value?.[2]??e[0].value?.[0]);let d;d=a>89?`${(0,b.NC)(c,t,r)}`:a>0?`${(0,b.ud)(c,t,r)}`:`${o?`${(0,b.ud)(c,t,r)}: `:""}${(0,y.mr)(c,t,r)} â€“ ${(0,y.mr)((0,n.T)(c,1),t,r)}`;const u=`<h4 style="text-align: center; margin: 0;">${d}</h4>`;let l=0,f=0,h=0,g=0;const m=e.map((e=>{const r=e.value?.[1],a=(0,_.uf)(r,t);return"0"!==a&&("bar"===e.componentSubType&&(r>0?(l+=r,f++):(h+=r,g++)),`${e.marker} ${e.seriesName}: ${a} ${s}`)})).filter(Boolean);let p="";return 0!==l&&f>1&&i&&(p+=`<br><b>${i(l)}</b>`),0!==h&&g>1&&i&&(p+=`<br><b>${i(h)}</b>`),m.length>0?`${u}${m.join("<br>")}${p}`:""}function S(e){Array.from(new Set(e.map((e=>e.data.map((e=>Number(e[0]))))).flat())).sort(((e,t)=>e-t)).forEach(((t,r)=>{const a={},o={};for(let s=e.length-1;s>=0;s--){const n=e[s].data[r],i=n&&"object"==typeof n&&"value"in n?n:{value:n},c=i.value?.[0],d=e[s].stack??"";void 0!==c&&(Number(c)!==t?e[s].data?.splice(r,0,{value:[t,0],itemStyle:{borderWidth:0}}):0===i.value?.[1]?e[s].data[r]={...i,itemStyle:{...i.itemStyle,borderWidth:0}}:!a[d]&&i.value?.[1]>0?(e[s].data[r]={...i,itemStyle:{...i.itemStyle,borderRadius:[4,4,0,0]}},a[d]=!0):!o[d]&&i.value?.[1]<0&&(e[s].data[r]={...i,itemStyle:{...i.itemStyle,borderRadius:[0,0,4,4]}},o[d]=!0))}}))}function $(e,t){if(!t)return e=>e;const r=(0,i.o)(e,t);if(0!==r&&e.getTime()===(0,c.e)(e).getTime())return e=>(0,d.B)(e,r);const a=(0,u.d)(e,t);if(0!==a&&e.getTime()===(0,l.N)(e).getTime())return e=>(0,f.z)(e,a);const o=e.getTime()-t.getTime();return e=>(0,h.n)(e,o)}[b,y,_]=g.then?(await g)():g,a()}catch(x){a(x)}}))},32672:function(e,t,r){r.a(e,(async function(e,a){try{r.r(t),r.d(t,{HuiEnergyUsageGraphCard:()=>S});var o=r(44249),s=(r(92745),r(92519),r(42179),r(89256),r(24931),r(88463),r(57449),r(19814),r(39527),r(41360),r(36993),r(42625)),n=r(83389),i=r(16444),c=r(57243),d=r(15093),u=r(35359),l=r(27486),f=r(20548),h=r(50602),_=r(25179),b=(r(54977),r(1118)),y=r(17705),g=r(6736),m=r(93331),p=r(53259),v=e([_,b,h,p]);[_,b,h,p]=v.then?(await v)():v;const k={to_grid:"--energy-grid-return-color",to_battery:"--energy-battery-in-color",from_grid:"--energy-grid-consumption-color",used_grid:"--energy-grid-consumption-color",used_solar:"--energy-solar-color",used_battery:"--energy-battery-out-color"};let S=(0,o.Z)([(0,d.Mo)("hui-energy-usage-graph-card")],(function(e,t){return{F:class extends t{constructor(...t){super(...t),e(this)}},d:[{kind:"field",decorators:[(0,d.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,d.SB)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,d.SB)()],key:"_chartData",value:()=>[]},{kind:"field",decorators:[(0,d.SB)()],key:"_start",value:()=>(0,s.I)()},{kind:"field",decorators:[(0,d.SB)()],key:"_end",value:()=>(0,n.p)()},{kind:"field",decorators:[(0,d.SB)()],key:"_compareStart",value:void 0},{kind:"field",decorators:[(0,d.SB)()],key:"_compareEnd",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value:()=>["_config"]},{kind:"method",key:"hassSubscribe",value:function(){return[(0,b.UB)(this.hass,{key:this._config?.collection_key}).subscribe((e=>this._getStatistics(e)))]}},{kind:"method",key:"getCardSize",value:function(){return 3}},{kind:"method",key:"setConfig",value:function(e){this._config=e}},{kind:"method",key:"shouldUpdate",value:function(e){return(0,m.SN)(this,e)||e.size>1||!e.has("hass")}},{kind:"method",key:"render",value:function(){return this.hass&&this._config?c.dy` <ha-card> ${this._config.title?c.dy`<h1 class="card-header">${this._config.title}</h1>`:""} <div class="content ${(0,u.$)({"has-header":!!this._config.title})}"> <ha-chart-base .hass="${this.hass}" .data="${this._chartData}" .options="${this._createOptions(this._start,this._end,this.hass.locale,this.hass.config,this._compareStart,this._compareEnd)}" chart-type="bar"></ha-chart-base> ${this._chartData.some((e=>e.data.length))?"":c.dy`<div class="no-data"> ${(0,i.z)(this._start)?this.hass.localize("ui.panel.lovelace.cards.energy.no_data"):this.hass.localize("ui.panel.lovelace.cards.energy.no_data_period")} </div>`} </div> </ha-card> `:c.Ld}},{kind:"field",key:"_formatTotal",value(){return e=>e>0?this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.total_consumed",{num:(0,h.uf)(e,this.hass.locale)}):this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.total_returned",{num:(0,h.uf)(-e,this.hass.locale)})}},{kind:"field",key:"_createOptions",value(){return(0,l.Z)(((e,t,r,a,o,s)=>{const n=(0,p.J)(e,t,r,a,"kWh",o,s,this._formatTotal);return{...n,tooltip:{...n.tooltip,formatter:e=>Array.isArray(e)?(e.sort(((e,t)=>{const r=e.value?.[1],a=t.value?.[1];return r>0&&a<0?-1:a>0&&r<0?1:r>0?t.componentIndex-e.componentIndex:e.componentIndex-t.componentIndex})),n.tooltip?.formatter?.(e)):""}}}))}},{kind:"method",key:"_getStatistics",value:async function(e){const t=[],r={};for(const t of e.prefs.energy_sources)if("solar"!==t.type)if("battery"!==t.type){if("grid"===t.type){for(const e of t.flow_from)r.from_grid?r.from_grid.push(e.stat_energy_from):r.from_grid=[e.stat_energy_from];for(const e of t.flow_to)r.to_grid?r.to_grid.push(e.stat_energy_to):r.to_grid=[e.stat_energy_to]}}else r.to_battery?(r.to_battery.push(t.stat_energy_to),r.from_battery.push(t.stat_energy_from)):(r.to_battery=[t.stat_energy_to],r.from_battery=[t.stat_energy_from]);else r.solar?r.solar.push(t.stat_energy_from):r.solar=[t.stat_energy_from];const a=getComputedStyle(this),o={};Object.keys(k).forEach((e=>{o[e]={},"used_grid"!==e&&"used_solar"!==e&&"used_battery"!==e&&r[e]&&Object.values(r[e]).forEach(((t,r)=>{o[e][t]=r}))}));const s={used_grid:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.combined_from_grid"),used_solar:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.consumed_solar"),used_battery:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.consumed_battery")};if(this._start=e.start,this._end=e.end||(0,n.p)(),this._compareStart=e.startCompare,this._compareEnd=e.endCompare,e.statsCompare)t.push(...this._processDataSet(e.statsCompare,e.statsMetadata,r,o,a,s,!0));else{const e=r.from_grid?.[0]??"placeholder";t.push({id:"compare-"+e,type:"bar",stack:"usage",data:[],order:0})}t.push(...this._processDataSet(e.stats,e.statsMetadata,r,o,a,s,!1)),t.sort(((e,t)=>e.order-t.order)),(0,p.Zx)(t),this._chartData=t}},{kind:"method",key:"_processDataSet",value:function(e,t,r,a,o,s,n=!1){const i=[],c={},d={};Object.entries(r).forEach((([t,r])=>{const a=["solar","to_grid","from_grid","to_battery","from_battery"].includes(t),o=!["solar","from_battery"].includes(t),s={},n={};r.forEach((t=>{const r=e[t];if(!r)return;const i={};r.forEach((e=>{if(null===e.change||void 0===e.change)return;const t=e.change;a&&(s[e.start]=e.start in s?s[e.start]+t:t),o&&!(e.start in i)&&(i[e.start]=t)})),n[t]=i})),a&&(d[t]=s),o&&(c[t]=n)}));const u={},l={};if((d.to_grid||d.to_battery)&&d.solar){const e={};for(const t of Object.keys(d.solar))e[t]=(d.solar[t]||0)-(d.to_grid?.[t]||0)-(d.to_battery?.[t]||0),e[t]<0&&(d.to_battery&&(u[t]=-1*e[t],u[t]>(d.from_grid?.[t]||0)&&(l[t]=u[t]-(d.from_grid?.[t]||0),u[t]=d.from_grid?.[t])),e[t]=0);c.used_solar={used_solar:e}}if(d.from_battery)if(d.to_grid){const e={};for(const t of Object.keys(d.from_battery))e[t]=(d.from_battery[t]||0)-(l[t]||0);c.used_battery={used_battery:e}}else c.used_battery={used_battery:d.from_battery};if(c.from_grid&&d.to_battery){const e={};for(const t of Object.keys(u)){let r,a=0;for(const[e,o]of Object.entries(c.from_grid))if(o[t]&&(r=e,a++),a>1)break;if(1===a)c.from_grid[r][t]-=u[t]||0;else{let r=0;Object.values(c.from_grid).forEach((e=>{r+=e[t]||0,delete e[t]})),e[t]=r-(u[t]||0)}}c.used_grid={used_grid:e}}let h=[];Object.values(c).forEach((e=>{Object.values(e).forEach((e=>{h=h.concat(Object.keys(e))}))}));const _=Array.from(new Set(h)).sort(((e,t)=>Number(e)-Number(t))),b=(0,p.kT)(this._start,this._compareStart);return Object.entries(c).forEach((([e,r],d)=>{Object.entries(r).forEach((([r,u])=>{const l=[];for(const t of _){const r=u[t]||0,a=[Number(t),r&&["to_grid","to_battery"].includes(e)?-1*r:r];n&&(a[2]=a[0],a[0]=b(a[0])),l.push(a)}i.push({id:n?"compare-"+r:r,type:"bar",cursor:"default",name:e in s?s[e]:(0,y.Kd)(this.hass,r,t[r]),order:"used_solar"===e?1:"to_battery"===e?Object.keys(c).length:d+2,barMaxWidth:50,itemStyle:{borderColor:(0,f.H)(o,this.hass.themes.darkMode,!1,n,k[e],a[e]?.[r])},color:(0,f.H)(o,this.hass.themes.darkMode,!0,n,k[e],a[e]?.[r]),stack:n?"compare":"usage",data:l})}))})),i}},{kind:"field",static:!0,key:"styles",value:()=>c.iv`ha-card{height:100%}.card-header{padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}.no-data{position:absolute;height:100%;top:0;left:0;right:0;display:flex;justify-content:center;align-items:center;padding:20%;margin-left:32px;margin-inline-start:32px;margin-inline-end:initial;box-sizing:border-box}`}]}}),(0,g.f)(c.oi));a()}catch(e){a(e)}}))},41924:function(e,t,r){r.d(t,{y:()=>o});var a=r(53907);function o(e){return(0,a.L)(e,Date.now())}},5376:function(e,t,r){r.d(t,{X:()=>n});var a=r(34151),o=r(76808),s=r(14276);function n(e,t,r){const n=(0,s._)(e,t)/o.yJ;return(0,a.u)(r?.roundingMethod)(n)}},83389:function(e,t,r){r.d(t,{p:()=>o});var a=r(96500);function o(e){return(0,a.i)(Date.now(),e)}},97836:function(e,t,r){r.d(t,{K:()=>s});var a=r(18492),o=r(7591);function s(e,t,r){const[s,n]=(0,a.d)(r?.in,e,t);return+(0,o.b)(s)==+(0,o.b)(n)}},16444:function(e,t,r){r.d(t,{z:()=>n});var a=r(53907),o=r(41924),s=r(97836);function n(e,t){return(0,s.K)((0,a.L)(t?.in||e,e),(0,o.y)(t?.in||e))}},42625:function(e,t,r){r.d(t,{I:()=>o});var a=r(7591);function o(e){return(0,a.b)(Date.now(),e)}}};
//# sourceMappingURL=40201.273eb396d56570ad.js.map
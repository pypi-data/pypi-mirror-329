(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[379,770],{32218:(e,t,o)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/trace/[id]",function(){return o(47851)}])},48850:(e,t,o)=>{"use strict";o.d(t,{A:()=>r});var n=o(74848);o(96540);let r=()=>(0,n.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-gray-900"})})},47851:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>S});var n=o(74848),r=o(96540),i=o(86715),l=o(77528),s=o(55456),a=o(87947),d=o(53692),u=o(88781);o(69703);var c=o(71468),f=o(36240),p=o(29838),w=o(79597),h=o(80893),b=(o(33596),o(53212)),y=o(48850),_=o(7651),k=o(95258),m=o(52136);let g=e=>{let{workflowData:t,workflowID:o,nodeOutputs:i,onDownloadImageInit:g,projectName:v="workflow"}=e,x=(0,c.wA)(),j=(0,c.d4)(e=>e.nodeTypes.data),{nodeTypes:C,isLoading:O}=(0,k.Tj)({nodeTypesConfig:j,readOnly:!0,includeCoalesceNode:!1}),E=(0,r.useMemo)(()=>({custom:e=>(0,n.jsx)(h.A,(0,s._)((0,l._)({},e),{readOnly:!0}))}),[]);(0,r.useEffect)(()=>{if(t){if(t.definition.nodes){let e=t.definition.nodes.filter(e=>"InputNode"===e.node_type&&null===e.parent_id);if(e.length>0){let t=e[0].config.input_schema;t&&Object.entries(t).map(e=>{let[t,o]=e;return{key:t,value:""}}).forEach(e=>{x((0,p.U)(e))})}}x((0,p.R$)({nodeTypes:j,definition:t.definition,workflowID:o,name:t.name})),x((0,p.f4)(i))}},[x,t,o]);let S=(0,c.d4)(e=>e.flow.nodes),N=(0,c.d4)(e=>e.flow.edges),D=(0,c.d4)(e=>e.flow.selectedNode),[I,P]=(0,r.useState)(null),[A,L]=(0,r.useState)({horizontal:null,vertical:null}),[M,T]=(0,r.useState)(null),[V,Q]=(0,r.useState)(null),z=(0,b.y)(e=>e.mode),{getIntersectingNodes:B,getNodes:K,updateNode:W}=(0,a.VH)(),{onNodesChange:R,onEdgesChange:F,onConnect:U}=(0,k.dW)({dispatch:x,nodes:S,setHelperLines:L}),q=(0,k.Bf)({edges:N,hoveredNode:M,hoveredEdge:V,selectedEdgeId:null,readOnly:!0}),G=(0,k.ml)({nodes:S,mode:z}),J=(0,k.Fu)({nodes:G}),Z=(0,r.useCallback)((e,t)=>{Q(t.id)},[]),X=(0,r.useCallback)(()=>{Q(null)},[]),$=(0,r.useCallback)(e=>{P(e),e.setViewport({x:0,y:0,zoom:.8})},[]),H=(0,r.useCallback)((e,t)=>{x((0,p.Qi)({nodeId:t.id}))},[x]),Y=(0,r.useCallback)(()=>{D&&x((0,p.Qi)({nodeId:null}))},[x,D]),ee=(0,r.useCallback)(e=>{e.forEach(e=>{x((0,p.AC)({nodeId:e.id})),D===e.id&&x((0,p.Qi)({nodeId:null}))})},[x,D]),et=(0,r.useCallback)(()=>{let e=(0,_.B)(S,N);x((0,p.CU)({nodes:e}))},[S,N,x]),eo=(0,r.useCallback)(e=>{let t=e.target,o=t.tagName.toLowerCase();if(t.isContentEditable||"input"===o||"textarea"===o||"select"===o)return;if("Delete"===e.key||"Backspace"===e.key){let e=S.filter(e=>e.selected);e.length>0&&ee(e)}let n=e.shiftKey?45:15;if(I){let{x:t,y:o,zoom:r}=I.getViewport();switch(e.key){case"ArrowLeft":I.setViewport({x:t+n,y:o,zoom:r});break;case"ArrowRight":I.setViewport({x:t-n,y:o,zoom:r});break;case"ArrowUp":I.setViewport({x:t,y:o+n,zoom:r});break;case"ArrowDown":I.setViewport({x:t,y:o-n,zoom:r})}}},[S,ee,I]);(0,r.useEffect)(()=>(window.addEventListener("keydown",eo),()=>{window.removeEventListener("keydown",eo)}),[eo]),(0,m.K)(D,S,C,j,x,et);let en=(0,r.useCallback)((e,t)=>{T(t.id)},[]),er=(0,r.useCallback)(()=>{T(null)},[]),ei=(0,r.useCallback)(()=>{let e=K(),t=(0,d.Jo)(e),o=t.width||1,n=t.height||1,r=Math.min(1080/o,607.5/n),i=(0,d.R4)(t,1200,675,r,r,.05*Math.min(o,n));(0,u.$E)(document.querySelector(".react-flow__viewport"),{backgroundColor:"transparent",width:1200,height:675,style:{width:"".concat(1200,"px"),height:"".concat(675,"px"),transform:"translate(".concat(i.x,"px, ").concat(i.y,"px) scale(").concat(i.zoom,")")}}).then(e=>{let t=document.createElement("a");t.href=e,t.download="".concat(v,"_trace.png"),t.click()}).catch(e=>{console.error("Failed to download image",e)})},[K,v]);return((0,r.useEffect)(()=>{g&&g(ei)},[ei,g]),O)?(0,n.jsx)(y.A,{}):(0,n.jsx)("div",{style:{position:"relative",height:"100%"},children:(0,n.jsxs)("div",{style:{width:"100%",height:"100%",overflow:"hidden"},children:[(0,n.jsx)("div",{style:{height:"100%",overflow:"auto",position:"relative",zIndex:1},children:(0,n.jsxs)(a.Gc,{nodes:J,edges:q,onNodesChange:R,onEdgesChange:F,onConnect:U,nodeTypes:C,edgeTypes:E,fitView:!0,onInit:$,onNodeClick:H,onPaneClick:Y,onNodesDelete:ee,proOptions:{hideAttribution:!0},panOnDrag:"hand"===z&&!S.filter(Boolean).some(e=>e.selected),panOnScroll:!0,zoomOnScroll:!0,minZoom:.1,maxZoom:2,selectionMode:"pointer"===z?d.Qc.Full:d.Qc.Partial,selectNodesOnDrag:"pointer"===z,selectionOnDrag:"pointer"===z,selectionKeyCode:"pointer"===z?null:void 0,multiSelectionKeyCode:"pointer"===z?null:void 0,deleteKeyCode:"Delete",nodesConnectable:!0,connectionMode:d.WZ.Loose,onNodeMouseEnter:en,onNodeMouseLeave:er,onEdgeMouseEnter:Z,onEdgeMouseLeave:X,snapToGrid:!1,children:[(0,n.jsx)(a.VS,{},"background"),!1,(0,n.jsx)(f.A,{handleLayout:et,handleDownloadImage:ei},"operator")]},"flow-".concat(o))}),D&&(0,n.jsx)("div",{className:"absolute top-0 right-0 h-full bg-white border-l border-gray-200",style:{zIndex:2},children:(0,n.jsx)(w.A,{nodeID:D},"node-sidebar-".concat(D))})]})})},v=e=>{let{workflowData:t,workflowID:o,nodeOutputs:r,onDownloadImageInit:i,projectName:l}=e;return(0,n.jsx)(a.Ln,{children:(0,n.jsx)(g,{workflowData:t,workflowID:o,nodeOutputs:r,onDownloadImageInit:i,projectName:l},"flow-content-".concat(o))})};var x=o(8640),j=o(68131),C=o(73232),O=o(48379),E=o(52798);let S=()=>{let e=(0,c.wA)(),{id:t}=(0,i.useRouter)().query,[o,a]=(0,r.useState)(null),[d,u]=(0,r.useState)({}),[f,w]=(0,r.useState)(null),[h,b]=(0,r.useState)(null),[_,k]=(0,r.useState)(),m=(0,c.d4)(e=>e.flow.projectName);return((0,r.useEffect)(()=>{e((0,O.WK)());let o=async()=>{try{var o;if("string"!=typeof t)return;let n=await (0,E.Wb)(t);if(w(n.workflow_id),a(n),null===(o=n.workflow_version)||void 0===o?void 0:o.definition){e((0,p.iD)(n.workflow_version.definition.test_inputs));let{rolledOutDefinition:t,outputs:o}=n.tasks?function(e){let{workflowDefinition:t,tasks:o}=e,n=JSON.parse(JSON.stringify(t)),r={};return o.forEach(e=>{if(e.outputs&&(r[e.node_id]=e.outputs),!e.subworkflow)return;if("ForLoopNode"===n.nodes.find(t=>t.id===e.node_id).node_type){e.subworkflow_output&&(r=(0,l._)({},r,e.subworkflow_output));return}let t=n.nodes.find(t=>t.id===e.node_id);if(!t)return;let o=e.subworkflow,i="".concat(e.node_id,"_");e.subworkflow_output&&Object.entries(e.subworkflow_output).forEach(e=>{let[t,o]=e;r[i+t]=o});let a=o.nodes.map(e=>(0,s._)((0,l._)({},e),{id:i+e.id,coordinates:{x:t.coordinates.x,y:t.coordinates.y}})),d=a.find(e=>"InputNode"===e.node_type),u=a.find(e=>"OutputNode"===e.node_type);if(!d||!u){console.error("Subworkflow missing input or output node");return}n.links.forEach(e=>{e.target_id===t.id&&(e.target_id=d.id),e.source_id===t.id&&(e.source_id=u.id)}),n.nodes=n.nodes.filter(e=>e.id!==t.id),n.nodes.push(...a),n.links=n.links.concat(o.links.map(e=>(0,s._)((0,l._)({},e),{source_id:i+e.source_id,target_id:i+e.target_id})))}),{rolledOutDefinition:n,outputs:r}}({workflowDefinition:n.workflow_version.definition,tasks:n.tasks}):{rolledOutDefinition:n.workflow_version.definition,outputs:n.outputs};b({name:n.workflow_version.name,definition:t}),o&&u(o)}}catch(e){console.error("Error fetching run:",e)}};t&&o()},[t,e]),h)?(0,n.jsx)(j.Q,{loading:null,persistor:C.q,children:(0,n.jsxs)("div",{style:{height:"100vh",display:"flex",flexDirection:"column"},children:[(0,n.jsx)(x.A,{activePage:"trace",associatedWorkflowId:f,runId:t,handleDownloadImage:_}),(0,n.jsx)("div",{style:{flexGrow:1},children:(0,n.jsx)(v,{workflowData:h,nodeOutputs:d,workflowID:f,onDownloadImageInit:e=>k(()=>e),projectName:m})})]})}):(0,n.jsx)(y.A,{})}},68131:(e,t,o)=>{"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}o.d(t,{Q:()=>a});var a=function(e){var t;function o(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o);for(var e,t,l,a=arguments.length,d=Array(a),u=0;u<a;u++)d[u]=arguments[u];return l=(e=(t=r(o)).call.apply(t,[this].concat(d)))&&("object"===n(e)||"function"==typeof e)?e:i(this),s(i(l),"state",{bootstrapped:!1}),s(i(l),"_unsubscribe",void 0),s(i(l),"handlePersistorState",function(){l.props.persistor.getState().bootstrapped&&(l.props.onBeforeLift?Promise.resolve(l.props.onBeforeLift()).finally(function(){return l.setState({bootstrapped:!0})}):l.setState({bootstrapped:!0}),l._unsubscribe&&l._unsubscribe())}),l}return!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(o,e),t=[{key:"componentDidMount",value:function(){this._unsubscribe=this.props.persistor.subscribe(this.handlePersistorState),this.handlePersistorState()}},{key:"componentWillUnmount",value:function(){this._unsubscribe&&this._unsubscribe()}},{key:"render",value:function(){return"function"==typeof this.props.children?this.props.children(this.state.bootstrapped):this.state.bootstrapped?this.props.children:this.props.loading}}],function(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(o.prototype,t),o}(o(96540).PureComponent);s(a,"defaultProps",{children:null,loading:null})}},e=>{var t=t=>e(e.s=t);e.O(0,[998,872,570,809,27,667,238,513,640,229,636,593,792],()=>t(32218)),_N_E=e.O()}]);
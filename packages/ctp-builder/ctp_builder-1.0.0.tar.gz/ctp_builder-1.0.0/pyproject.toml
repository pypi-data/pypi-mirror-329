[build-system]
requires = ["hatchling", "versioningit"]
build-backend = "hatchling.build"

[project]
name = "ctp-builder"
dynamic = ["version"]
readme = "README.md"
license = {file = "LICENSE"}
requires-python = ">=3.9"
authors = [
    { name = "Ivan Bocharov" },
    { name = "Adriaan Versteeg" },
    { name = "Hakim Achterberg" },
]
dependencies = [
    "click >= 8.1.0",
    "click_loglevel",
    "jinja2",
    "pytest",
    "PyYAML == 6.0.2",
    "requests",
]

[project.scripts]
ctpbuild = "ctp_builder.cli:cli"

[project.urls]
"CI/CD" = "https://gitlab.com/radiology/infrastructure/data-curation-tools/ctp-builder/-/pipelines"
Changelog = "https://ctp-builder.readthedocs.io/en/latest/changelog.html"
Documentation = "https://ctp-builder.readthedocs.io"
Download = "https://gitlab.com/radiology/infrastructure/data-curation-tools/ctp-builder/-/archive/master/ctp-builder-master.zip"
Homepage = "https://gitlab.com/radiology/infrastructure/data-curation-tools/ctp-builder"
Issues = "https://gitlab.com/radiology/infrastructure/data-curation-tools/ctp-builder/-/issues"

[tool.hatch.build.targets.wheel]
exclude = [
    "ctp_builder/tests",
]

[tool.hatch.version]
source = "versioningit"

[tool.hatch.version.format]
distance = "{base_version}.post{distance}.dev0"

[tool.hatch.version.write]
file = 'ctp_builder/version.py'
template = """
# This file is automatically generated by versioningit during build stage. Do not edit it manually.
# Configuration is stored in the pyproject.toml file.

version = '{version}'
version_tuple = {version_tuple}
base_version = '{base_version}'  # Latest released version known at build time
git_revision = '{rev}'
git_revision_full = '{revision}'
git_branch = '{branch}'
git_revision_date = '{author_date:%Y-%m-%dT%H:%M:%S}'
build_date = '{build_date:%Y-%m-%dT%H:%M:%S}'
"""

[tool.hatch.build]
artifacts = ["ctp_builder/version.py"]


[tool.hatch.build.targets.sdist]
include = [
    "/ctp_builder",
]

[tool.hatch.envs.hatch-test]
default-args = ["ctp_builder", "-vv"]
extra-dependencies = [
    "pytest-cov>=4.0.0",
    "pytest-mock>=3.10.0",
]

[tool.black]
line_length = 120

[tool.isort]
profile = "black"
line_length = 120

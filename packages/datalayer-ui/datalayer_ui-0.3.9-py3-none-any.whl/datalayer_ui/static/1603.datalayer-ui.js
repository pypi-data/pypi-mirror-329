"use strict";(self.webpackChunk_datalayer_ui=self.webpackChunk_datalayer_ui||[]).push([[1603],{90064:(e,t,n)=>{n.d(t,{H:()=>l});var s=n(16909),r=n(82176),o=n(82299),i=n(72964),a=n(47011);function l(e){const{serviceManager:t,kernelId:n,onClick:l,onUpdate:c}=e,[d,u]=(0,s.useState)();return(0,s.useEffect)((()=>{t.kernels.findById(n).then((e=>{u(e)}))}),[n,t]),d?(0,a.jsxs)(r.Z,{display:"flex",style:{alignItems:"center"},children:[(0,a.jsx)(r.Z,{style:{padding:"0 4px",userSelect:"none"},children:(0,a.jsx)(o.Pl,{type:"credits"})}),(0,a.jsx)(i.E,{startedAt:parseFloat(d.started_at),expiredAt:d.expired_at?parseFloat(d.expired_at):void 0,burningRate:d.burning_rate,onClick:l,onUpdate:c,style:{cursor:"pointer"}})]}):(0,a.jsx)(a.Fragment,{})}},25255:(e,t,n)=>{n.d(t,{Z:()=>l});var s=n(45205),r=n(68110),o=n(43275),i=n(16909),a=n(47011);function l(e){const{commandRegistry:t,kernelDesc:n,save:l,sessionConnection:c}=e,[d,u]=(0,i.useState)();return(0,i.useEffect)((()=>{const e=()=>{u(c?.kernel?.status)};return e(),c?.statusChanged.connect(e),c?.connectionStatusChanged.connect(e),()=>{c?.statusChanged.disconnect(e),c?.connectionStatusChanged.disconnect(e)}}),[c]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.r,{variant:"invisible",size:"small",leadingVisual:o.Mfv,disabled:void 0===n?.location,onClick:l,children:"Save"}),(0,a.jsx)(r.r,{variant:"invisible",size:"small",leadingVisual:o.o1U,disabled:!n?.location||"busy"===d,onClick:e=>{t?.execute(s.zl.runAll)},children:"Run all"}),(0,a.jsx)(r.r,{variant:"invisible",size:"small",leadingVisual:o.wNq,disabled:!n?.location||"busy"!==d,onClick:e=>{t?.execute(s.zl.interrupt)},children:"Interrupt"})]})}},71603:(e,t,n)=>{n.r(t),n.d(t,{NotebookEdit:()=>Et,default:()=>Mt});var s=n(35562),r=n(46523),o=n(5575),i=n(47011),a=n(70994),l=n(16909),c=n(83504),d=n(29907),u=n(44066),m=n(39265),h=n(30102),p=n(3202),f=n(2585),g=n(51834),x=n(79418),v=n(68311),b=n(81392),y=n(5952),j=n(40393),k=n(46086),w=n(91412),C=n(82724),S=n(71801),P=n(77268),_=n(37371),Z=n(4632),T=n(59913),D=n(30148),N=n(16982),E=n(54649),M=n(59555),R=n(54362),I=n(97001),L=n(46744),A=n(52012),V=n(17389),$=n(92664),z=n(82628),F=n(94910),U=n(15889),O=n(26766),B=n(80469),K=n(45205);const H=1e3,q=new Array,G=".datalayer/ping.ipynb";function W(e){const{CellSidebar:t,commandRegistry:n,extensions:s=q,kernelId:o,serviceManager:c,model:d,nbgrader:g,onSessionConnectionChanged:v}=e,[b,y]=(0,l.useState)(!0),[j,S]=(0,l.useState)(new Array),P=(0,r.ZP)(),_=(0,l.useMemo)((()=>e.id||(0,z.ZI)()),[e.id]),Z=(0,l.useMemo)((()=>e.path||G),[e.path]),D=(0,l.useMemo)((()=>new J({commandRegistry:n})),[n]),N=(0,l.useMemo)((()=>new B.ex(_,g,D.commandRegistry,{editorFactory:D.editorServices.factoryService.newInlineEditor},t)),[t,_,D,g]),[E,A]=(0,l.useState)(null);(0,l.useEffect)((()=>{const e=new u.X({model:new m.B}),t=new R.$L,n=new h.K({context:{widget:t},providers:[new p.D],timeout:H}),s=new f._({completer:e,reconciliator:n});return e.hide(),R.$L.attach(e,document.body),A(s),()=>{s.dispose(),e.dispose(),t.dispose()}}),[]);const[V,$]=(0,l.useState)(null);(0,l.useEffect)((()=>{const e=new k.y({name:"Notebook",label:"Notebook",modelName:"notebook",fileTypes:["notebook"],defaultFor:["notebook"],preferKernel:!0,autoStartDefault:!1,canStartKernel:!1,shutdownOnClose:!1,rendermime:D.rendermime,contentFactory:N,mimeTypeService:D.editorServices.mimeTypeService,notebookConfig:{...w.l.defaultNotebookConfig,recordTiming:!0}});return $(e),()=>{e.dispose(),$((t=>t===e?null:t))}}),[N,D]);const[W,Q]=(0,l.useState)(null);(0,l.useEffect)((()=>{const t=E?new C.a({namespace:_}):null,n=E?(0,K.ZP)(D.commandRegistry,E,t,e.path):null;return Q(t),()=>{n?.dispose(),t?.dispose(),Q((e=>e===t?null:e))}}),[E,_,D.commandRegistry,e.path]);const[X,ee]=(0,l.useState)(null);(0,l.useEffect)((()=>{const e=new Y(d),t=new x._({factory:e,manager:c,path:Z,kernelPreference:{shouldStart:!1,canStart:!1,autoStartDefault:!1,shutdownOnDispose:!1}});return function(e,t,n,s){const r=!n;e.sessionContext._initialize=async()=>{const t=e.sessionContext.sessionManager;await t.ready,await t.refreshRunning();const s=(0,T.sE)(t.running(),(t=>t.kernel?.id===(e.sessionContext.kernelPreference.id??"")));if(s)try{const r=t.connectTo({model:{...s,path:n??s.path,name:n??s.name},kernelConnectionOptions:{handleComms:!0}});e.sessionContext._handleNewSession(r),this._kernel?.connection?.dispose()}catch(t){return e.sessionContext._handleSessionError(t),Promise.reject(t)}return await e.sessionContext._startIfNecessary()},e.dispose=()=>{e.isDisposed||(e._isDisposed=!0,e.sessionContext.dispose(),e._disposed.emit(void 0),M.Signal.clearData(this))},r&&(e._populate=async()=>{if(e._isPopulated=!0,e._isReady=!0,e._populatedPromise.resolve(void 0),e.isDisposed)return;const t=e._model.defaultKernelName||e.sessionContext.kernelPreference.name;e.sessionContext.kernelPreference={...e.sessionContext.kernelPreference,name:t,language:e._model.defaultKernelLanguage},e.sessionContext.initialize().then((t=>{t&&e._dialogs.selectKernel(e.sessionContext.sessionContext)}))},e.initialize=async n=>{e.model.dirty=!1;const s=(new Date).toISOString(),r={path:t,name:t,type:"notebook",content:void 0,writable:!0,created:s,last_modified:s,mimetype:"application/x-ipynb+json",format:"json"};e._updateContentsModel(r),await e._populate(),e.model.sharedModel.clearUndoHistory()}),e.sessionContext.sessionChanged.connect(((e,t)=>{const n=t.newValue;console.log("Current Jupyter Session Connection.",n),s?.(n??void 0)})),e.sessionContext.kernelChanged.connect(((e,t)=>{const n=t.newValue;console.log("Current Jupyter Kernel Connection.",n),n&&!n.handleComms&&(console.log("Updating the current Kernel Connection to enforce Comms support.",n.handleComms),n.handleComms=!0)})),e.sessionContext.ready.then((()=>{s?.(e?.sessionContext.session??void 0)})),e.initialize(!n)}(t,_,Z!==G?Z:void 0,v),ee(t),()=>{t.dispose(),e.dispose(),ee((e=>e===t?null:e))}}),[_,c,d,v,Z]),(0,l.useEffect)((()=>{X&&o&&X.sessionContext.changeKernel({id:o})}),[X,o]);const[te,ne]=(0,l.useState)(null);(0,l.useEffect)((()=>{let e=null;return X&&(e=V?.createNew(X)??null,e&&(e.content.modelChanged.connect(((e,t)=>{e.model&&P.changeModel({id:_,notebookModel:e.model})})),e.content.activeCellChanged.connect(((e,t)=>{if(null===t)P.activeCellChange({id:_,cellModel:void 0});else if(P.activeCellChange({id:_,cellModel:t}),!X.model.readOnly){const e=document.getElementById("right-panel-id");if(e){const n=(0,i.jsx)(a.Z,{mt:3,children:(0,i.jsx)(O.o,{notebookId:_,cell:t,nbgrader:g})}),s=(0,L.createPortal)(n,e);P.setPortalDisplay({id:_,portalDisplay:{portal:s,pinned:!1}})}}})),e.sessionContext.statusChanged.connect(((e,t)=>{P.changeKernelStatus({id:_,kernelStatus:t})})),S(s.map((t=>(t.init({notebookId:_,commands:D.commandRegistry,panel:e}),t.createNew(e,X),t.component??(0,i.jsx)(i.Fragment,{}))))),y(!1))),ne(e),e||S([]),()=>{try{e?.dispose()}catch(e){}ne((t=>t===e?null:t))}}),[X,E,s,D.commandRegistry,g,P,V]),(0,l.useEffect)((()=>{let e=!0;return te&&(W&&(W.has(te)||W.add(te).catch((e=>{console.error(`Failed to track the notebook panel '${_}'.`)}))),E&&te.context.sessionContext.ready.then((()=>{if(!e)return;const t=te.content.activeCell?.editor,n=new p.D,s=new h.K({context:{widget:te,editor:t,session:te.context.sessionContext.session},providers:[n],timeout:H});E.editor=t,E.reconciliator=s,te.content.activeCellChanged.connect(((e,t)=>{t&&t.ready.then((()=>{E.editor=t?.editor}))}))}))),()=>{e=!1,E&&(E.editor=null,E.reconciliator=new h.K({context:{widget:new R.$L},providers:[new p.D],timeout:H}))}}),[E,te,W]);const se=(0,l.useCallback)((e=>{D.commandRegistry.processKeydownEvent(e)}),[D.commandRegistry]);return(0,i.jsxs)(i.Fragment,{children:[j.map(((e,t)=>(0,i.jsx)(a.Z,{children:e},`${e}-${t}`))),b?(0,i.jsx)(U.a,{},"notebook-loader"):te?(0,i.jsx)(a.Z,{sx:{height:"100%"},onKeyDownCapture:se,children:(0,i.jsx)(F.Y,{id:_,children:te},"notebook-container")}):(0,i.jsx)(I.j,{variant:"critical",description:"Unable to create the notebook view.",hideTitle:!0},"notebook-error")]})}class J{_commandRegistry;_editorServices;_rendermime;constructor(e={}){this._commandRegistry=e.commandRegistry??new D.H;const t=new d.BE;for(const e of d.BE.getDefaultLanguages())t.addLanguage(e);t.addLanguage({name:"ipythongfm",mime:"text/x-ipythongfm",load:async()=>(await Promise.all([n.e(534),n.e(1891),n.e(8159),n.e(5863)]).then(n.bind(n,75863))).markdown({codeLanguages:e=>t.findBest(e)})});const s=_.Nf.filter((e=>"text/javascript"!==e.mimeTypes[0]));s.push(b.rendererFactory),s.push(v.rendererFactory),this._rendermime=new Z.D({initialFactories:s,latexTypesetter:new j.U,markdownParser:(0,y.createMarkdownParser)(t)});const r=new d.E1(t),o=new d.Ie;for(const e of d.Ie.getDefaultThemes())o.addTheme(e);const i=new d.rM({extensions:(()=>{const e=new d.C9;for(const t of d.C9.getDefaultExtensions({themes:o}))e.addExtension(t);return e.addExtension({name:"shared-model-binding",factory:e=>{const t=e.model.sharedModel;return d.C9.createImmutableExtension((0,d.Zw)({ytext:t.ysource,undoManager:t.undoManager??void 0}))}}),e})(),languages:t});this._editorServices={factoryService:i,mimeTypeService:r}}get commandRegistry(){return this._commandRegistry}get editorServices(){return this._editorServices}get rendermime(){return this._rendermime}}class Y extends P.w{model;constructor(e){super(),this.model=e}createNew(e){return this.model}}function Q(e){const{CellSidebar:t,Toolbar:n,cellSidebarMargin:s=120,children:r,collaborationServer:o,commandRegistry:d,extensions:u,height:m="100vh",maxHeight:h="100vh",id:p,nbformat:f,nbgrader:x=!1,onNotebookModelChanged:v,onSessionConnection:b,path:y,readonly:j=!1,serviceManager:k,startDefaultKernel:w=!1,url:C}=e,P=function(e){const{kernels:t,requestedKernelId:n,startDefaultKernel:s=!1}=e,[r,o]=(0,l.useState)(void 0);return(0,l.useEffect)((()=>{let e,r=!0;return(async()=>{let i;if(await t.ready,n)for(const e of t.running())if(e.id===n){i=n;break}!i&&s&&r&&(console.log("Starting new kernel."),e=await t.startNew(),r?i=e.id:e.dispose()),r&&o(i)})(),()=>{r=!1,e?.dispose()}}),[t,n,s]),r}({requestedKernelId:e.kernelId,kernels:k.kernels,startDefaultKernel:w}),_=function(e){const{collaborationServer:t,nbformat:n,readonly:s=!1,url:r}=e,[o,i]=(0,l.useState)(null);return(0,l.useEffect)((()=>{let e=!0;const o=new E.DisposableSet;if(t){let e=null,n=new N.PromiseDelegate,r=!0,a=null;const l=t=>{t.code>1e3&&(console.error("Connection with the room has been closed unexpectedly.",t),e?.disconnect(),4002===t.code&&(e?.destroy(),n.reject("Connection closed."),n=new N.PromiseDelegate,r&&Promise.all([u(),n.promise,(0,z._v)(500)]).catch((e=>{console.error("Failed to setup collaboration connection.",e)}))))},d=t=>{t&&(e?.off("sync",d),n.resolve(void 0))},u=async()=>{a=new c.hN;const{ydoc:n,awareness:r}=a;let o="",u="";const m={};if("jupyter"==t.type){const{path:e,serverSettings:n}=t,s=await(0,V.jf)("json","notebook",e,n);o=g.URLExt.join(n.wsUrl,V.W8),u=`${s.format}:${s.type}:${s.fileId}`,m.sessionId=s.sessionId,n.token&&(m.token=n.token)}else if("datalayer"==t.type){const{baseURL:e,roomName:n,token:s}=t;u=n;const r=g.URLExt.join(e,"/api/spacer/v1/rooms");o=r.replace(/^http/,"ws"),m.sessionId=await(0,$.J)({url:g.URLExt.join(r,u),token:s}),m.token=s}if(m.sessionId){e=new A.VU(o,u,n,{disableBc:!0,params:m,awareness:r}),e.on("sync",d),e.on("connection-close",l),console.log("Collaboration is setup with websocket provider.");const t=new S.V({collaborationEnabled:!0,disableDocumentWideUndoRedo:!0,sharedModel:a});t.readOnly=s,i(t)}};Promise.all([u(),n.promise]).then((()=>{if(e){const t=()=>{(e.synced?Promise.resolve():n.promise).finally((()=>{e.off("sync",d),e.off("connection-close",l),e.disconnect(),e.destroy()}))};r?o.add(Object.freeze({dispose:t,isDisposed:!1})):t()}})).catch((e=>{console.error("Failed to setup collaboration connection.",e)}))}else{const t=e=>{const t=new S.V;e&&(e.cells.forEach((e=>{e.metadata.editable=!s})),t.fromJSON(e)),t.readOnly=s,i(t)};!n&&r?async function(e){return fetch(e).then((e=>e.text())).then((e=>JSON.parse(e)))}(r).then((n=>{e&&t(n)})):t(n)}return()=>{e=!1,o.dispose()}}),[t,n,s,r]),o}({collaborationServer:o,nbformat:f,readonly:j,url:C});return(0,l.useEffect)((()=>{v?.(_)}),[_,v]),(0,i.jsxs)(a.Z,{style:{height:m,width:"100%",position:"relative"},id:"dla-Jupyter-Notebook",children:[n&&(0,i.jsx)(n,{notebookId:p}),(0,i.jsxs)(a.Z,{className:"dla-Box-Notebook",sx:{height:m,maxHeight:h,width:"100%",overflowY:"hidden","& .datalayer-NotebookPanel-header":{minHeight:"50px"},"& .jp-Notebook":{flex:"1 1 auto !important",height:"100%",overflowY:"scroll"},"& .jp-NotebookPanel":{height:"100% !important",width:"100% !important"},"& .jp-Toolbar":{display:"none",zIndex:0},"& .jp-Toolbar .jp-HTMLSelect.jp-DefaultStyle select":{fontSize:"14px"},"& .jp-Toolbar > .jp-Toolbar-responsive-opener":{display:"none"},"& .jp-Toolbar-kernelName":{display:"none"},"& .jp-Cell":{width:`calc(100% - ${s}px)`},"& .jp-Notebook-footer":{width:`calc(100% - ${s+82}px)`},"& .jp-Cell .jp-CellHeader":{position:"absolute",top:"-5px",left:`${s+10}px`,height:"auto"},"& .jp-Cell .dla-CellSidebar-Container":{padding:"4px 8px",width:`${s+10}px`,marginLeft:"auto"},"& .jp-CodeMirrorEditor":{cursor:"text !important"},".dla-Box-Notebook":{position:"relative"}},children:[r,_&&k&&(0,i.jsx)(W,{CellSidebar:t,commandRegistry:d,id:p,extensions:u,model:_,nbgrader:x,serviceManager:k,kernelId:P,onSessionConnectionChanged:b,path:y})]})]})}var X=n(19316),ee=n(43275),te=n(88625),ne=n(15358),se=n(50350),re=n(82176),oe=n(68110),ie=n(68777),ae=n(56143),le=n(44860),ce=n(79424),de=n(88567),ue=n(97663),me=n(15970);const he=e=>{const{data:t,fileName:n,variant:s,extension:r}=e;return(0,i.jsx)(oe.r,{variant:s,leadingVisual:ee._8t,onClick:e=>(0,me.DS)(t,n,r),children:"Download"})};he.defaultProps={variant:"default",name:"data",extension:"json"};var pe=n(82299),fe=n(46692),ge=n(63234),xe=n(44984),ve=n(21735),be=n(80609),ye=n(39067),je=n(50135),ke=n(76411),we=n(53338),Ce=n(78079),Se=function(e){return e[e.None=0]="None",e[e.New=1]="New",e[e.Transfer=2]="Transfer",e}(Se||{});function Pe(e){const{assignKernel:t,sessionConnection:n}=e,{remoteKernels:s,multiServiceManager:r,jupyterLabAdapter:o}=(0,Ce.zG)(),[a,c]=(0,l.useState)(),[d,u]=(0,l.useState)({}),[m,h]=(0,l.useState)(Se.None),[p,f]=(0,l.useState)("");(0,l.useEffect)((()=>{if(n){function e(e){f(`Runtime ${e.kernel?.connectionStatus} - Status: ${e.kernel?.status}`)}return e(n),n?.statusChanged.connect(e),n?.connectionStatusChanged.connect(e),()=>{n?.statusChanged.disconnect(e),n?.connectionStatusChanged.disconnect(e)}}f("No kernel")}),[n]);const g=(0,l.useCallback)((async()=>{r?.remote?.kernels&&await r.remote.kernels.refresh()}),[r?.remote?.kernels]),x=(0,l.useCallback)((()=>{h(Se.New)}),[]),v=(0,l.useCallback)((e=>{if(e)switch(m){case Se.New:g().then((()=>{c("remote"),t({kernelDesc:e,kernelModel:r?.remote?.kernels.get().find((t=>t.id===e.id))})}));break;case Se.Transfer:c("remote"),t({kernelDesc:e,transferState:!0})}h(Se.None)}),[g,r?.remote,m]);return(0,l.useEffect)((()=>{o?Promise.all([o.jupyterLab.resolveOptionalService(be.sc),o.jupyterLab.resolveOptionalService(ve.hd)]).then((e=>{u({[be.sc.name]:e[0],[ve.hd.name]:e[1]})})):u({})}),[o]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(ye.P,{children:[(0,i.jsx)(ye.P.Button,{leadingVisual:()=>{switch(a){case"browser":return(0,i.jsx)(fe.Z,{});case"remote":return(0,i.jsx)(ee.v3n,{});case void 0:return(0,i.jsx)(ee.tEF,{})}return(0,i.jsx)(pe.Pl,{type:"kernel"})},trailingVisual:()=>n?(0,i.jsx)(re.Z,{sx:{paddingTop:"5px"},children:(0,i.jsx)(xe.uA,{kernel:n.kernel})}):(0,i.jsx)(i.Fragment,{}),variant:"invisible",children:(0,i.jsx)(je.Z,{"aria-label":p,direction:"s",children:n?n.kernel?.name:"Runtimes"})}),(0,i.jsx)(ye.P.Overlay,{width:"medium",children:(0,i.jsxs)(ke.S,{selectionVariant:"single",showDividers:!0,children:[(0,i.jsxs)(ke.S.Group,{children:[(0,i.jsxs)(ke.S.Item,{selected:void 0===a,onSelect:()=>{c(void 0),t({kernelDesc:void 0})},children:[(0,i.jsx)(ke.S.LeadingVisual,{children:(0,i.jsx)(ee.tEF,{})}),"Viewer",(0,i.jsx)(ke.S.Description,{variant:"block",children:"A simple Notebook Viewer without Runtime."})]}),(0,i.jsxs)(ke.S.Item,{selected:"browser"===a,onSelect:()=>{c("browser"),t({kernelDesc:{name:"pyodide",location:"browser",language:"python"}})},children:[(0,i.jsx)(ke.S.LeadingVisual,{children:(0,i.jsx)(fe.Z,{})}),"Browser Runtime",(0,i.jsx)(ke.S.Description,{variant:"block",children:"A Browser Runtime based on Pyodide."})]})]}),s.length>0&&(0,i.jsxs)(ke.S.Group,{children:[(0,i.jsx)(ke.S.GroupHeading,{children:"Cloud Runtimes"}),s.map((e=>(0,i.jsxs)(ke.S.Item,{selected:n?.kernel?.id===e.id,onSelect:()=>{c("remote"),t({kernelDesc:{name:e.environment_name,language:"",location:"remote",displayName:e.kernel_given_name,id:e.id,burningRate:e.burning_rate,podName:e.jupyter_pod_name},kernelModel:e})},children:[(0,i.jsx)(ke.S.LeadingVisual,{children:(0,i.jsx)(pe.Pl,{type:"kernel"})}),e.kernel_given_name,(0,i.jsx)(ke.S.Description,{variant:"block",children:e.environment_name})]},e.id)))]}),(0,i.jsx)(ke.S.Divider,{}),(0,i.jsxs)(ke.S.Group,{children:[(0,i.jsxs)(ke.S.Item,{selected:!1,onSelect:x,children:[(0,i.jsx)(ke.S.LeadingVisual,{children:(0,i.jsx)(ge.Z,{})}),"Launch a new Runtime…"]}),(0,i.jsxs)(ke.S.Item,{disabled:"browser"!==a,selected:!1,onSelect:()=>{h(Se.Transfer)},title:"Transfer the state of the current Runtime to a new Remote Runtime.",children:[(0,i.jsx)(ke.S.LeadingVisual,{children:(0,i.jsx)(ee.NoM,{})}),"Transfer state to a new Runtime…"]})]})]})})]}),r?.remote&&m>0&&(0,i.jsx)(we.h,{dialogTitle:m===Se.Transfer?"Switch to a new Cloud Runtime":void 0,manager:r.remote,onSubmit:v,markdownParser:d[be.sc.name],sanitizer:d[ve.hd.name],startKernel:m===Se.Transfer?"defer":m===Se.New})]})}var _e=n(90064),Ze=n(28729),Te=n(46184),De=n(94245),Ne=n(1481),Ee=n(62171),Me=n(35928),Re=n(16541),Ie=n(84687),Le=n(18342);function Ae(e){const{children:t,connection:n,podName:s,multiServiceManager:r,disabled:o}=e,{addKernelSnapshot:a,jupyterRunUrl:c,kernelSnapshots:d,setKernelSnapshots:u}=(0,Ce.zG)(),{trackAsyncTask:m}=(0,Me.p)(),[h,p]=(0,l.useState)(!1),[f,g]=(0,l.useState)(!1),[x,v]=(0,l.useState)(!1),[b,y]=(0,l.useState)(d[0]?.id??""),[j,k]=(0,l.useState)();(0,l.useEffect)((()=>{(0,Re.Vq)().then((e=>{u(e),!b&&e.length>0&&y(e[0].id)})).catch((e=>{console.error(`Failed to fetch remote kernel snapshots; ${e}`)}))}),[c]);const w=(0,l.useCallback)((()=>{k(void 0),p(!0)}),[]),C=(0,l.useCallback)((e=>{y(e.target.value)}),[]),S=(0,l.useCallback)((async({id:e,connection:t,podName:n})=>{n?await(0,Re.kd)({id:n,from:e}):t&&await(0,Ie.j)({connection:t,id:e})}),[]),P=(0,l.useCallback)((async()=>{try{let e,t;v(!0);let o="",i="";if(s&&r?.remote)i=(0,Le.p)("cloud"),t=r.remote.kernels.snapshot({podName:s,name:i,description:i,stop:!1}),o=s.split("-",2).reverse()[0],t.then((t=>{e=t}));else if(n&&r?.browser){const s=n.model;o=s.id,i=(0,Le.p)("browser");let a=!0;t=(0,Ie.k)({connection:r.browser.kernels.connectTo({model:s}),metadata:{filename:`${i}.data`},onUploadProgress:()=>{a&&(a=!1,(0,Re.Vq)().then((t=>{e=t.find((e=>e.name===i))})))}})}t&&(m(t,{error:{message:(e,t)=>"Empty snapshot"==e?`Runtime ${o} will not be snapshotted as it does not contain any serializable state.`:`Failed to pause runtime ${o} - ${e}`},pending:{message:`Taking a snapshot of runtime ${o}…`},success:{message:()=>`Runtime ${o} successfully snapshotted as ${i}.`}}),await t,e&&a(e))}finally{v(!1)}}),[n,s,r]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(ye.P,{children:[(0,i.jsx)(ye.P.Button,{leadingVisual:Ze.Z,variant:"invisible",disabled:f||x||o,children:t}),(0,i.jsx)(ye.P.Overlay,{children:(0,i.jsxs)(ke.S,{children:[(0,i.jsx)(ke.S.Item,{onSelect:w,disabled:f||0==d.length,children:"Load a runtime snapshot…"}),(0,i.jsx)(ke.S.Item,{onSelect:P,disabled:x,children:"Take a runtime snapshot"})]})})]}),h&&(0,i.jsx)(Ee.V,{title:"Choose a runtime snapshot to load",onClose:()=>{p(!1)},footerButtons:[{buttonType:"default",content:"Cancel",onClick:e=>{e.defaultPrevented||(e.preventDefault(),p(!1))}},{buttonType:"primary",content:f?(0,i.jsx)(Te.Z,{size:"small"}):"Load",disabled:f,onClick:async e=>{if(!e.defaultPrevented){e.preventDefault(),g(!0);try{k(void 0);const e=d.find((e=>e.id===b));e&&(n||s)?await S({connection:n,id:e.id,podName:s}):k("No runtime snapshot found.")}finally{g(!1),p(!1)}}},autoFocus:!0}],children:(0,i.jsxs)(re.Z,{as:"form",children:[(0,i.jsxs)(le.Z,{children:[(0,i.jsx)(le.Z.Label,{children:"Snapshot"}),(0,i.jsx)(De.Z,{name:"snapshot",value:b,onChange:C,block:!0,children:d.map((e=>(0,i.jsx)(De.Z.Option,{value:e.id,children:e.name?`${e.name} (${e.id})`:e.id},e.id)))})]}),j&&(0,i.jsx)(Ne.Z,{variant:"danger",children:j})]})})]})}Ae.defaultProps={disabled:!1};var Ve=n(34166),$e=n(98014),ze=n(51556),Fe=n(56768),Ue=n(6595);const Oe=1048576;function Be({contents:e,documentRegistry:t}){const n=(0,Fe.tm)(),{trackAsyncTask:s}=(0,Me.p)(),[r,o]=(0,l.useState)(null),[a,c]=(0,l.useState)(!0),[d,u]=(0,l.useState)(null),[m,h]=(0,l.useState)(null),[p,f]=(0,l.useState)(!1),x=(0,l.useCallback)((()=>{if(d){const t=e.delete(d.path);s(t,{error:{message:e=>{const t=`Failed to delete ${d.path}.`;return console.error(t,e),t}},pending:{message:`Deleting ${d.path}…`},success:{message:()=>`${d.path} deleted.`}}),t.finally((()=>{d.refresh()}))}f(!1)}),[e,d]),v=(0,l.useCallback)((()=>{e.get("").then((e=>{c(!1),o(qe(e.content,t))})).catch((t=>{c(!1),console.error(`Failed to fetch folder '' content for manager ${e.serverSettings.appUrl}.`,t)}))}),[e]),b=(0,l.useCallback)((async t=>{const r=()=>{if(!n())return Promise.reject(`Failed to upload ${t.name}; FileBrowser component is unmounted.`)};r();const o=t.size>Oe,i=d?"directory"===d.type?d.path:g.PathExt.dirname(d.path):"",a=i?g.PathExt.join(i,t.name):t.name,l=t.name,c=async(n,s)=>{r();const o=new FileReader;o.readAsDataURL(n),await new Promise(((e,n)=>{o.onload=e,o.onerror=e=>n(`Failed to upload "${t.name}":`+e)})),r();const i=o.result.split(",")[1],c={type:"file",format:"base64",name:l,chunk:s,content:i};return await e.save(a,c)},u={error:{message:e=>{const n=`Failed to upload ${t.name}.`;return console.error(n,e),n}},pending:{message:`Uploading ${t.name}…`},success:{message:()=>`${t.name} uploaded.`}};if(!o){const e=c(t);return s(e,u),e.then((()=>{d?d.refresh():v()})),e}{const e=new N.PromiseDelegate;s(e.promise,u);try{let n;for(let s=0;!n;s+=Oe){const r=s+Oe,o=r>=t.size,i=o?-1:r/Oe,a=await c(t.slice(s,r),i);o&&(n=a,e.resolve(n))}return d?d.refresh():v(),n}catch(t){throw e.reject(t),t}}}),[e,d,v]);(0,l.useEffect)((()=>{v()}),[v]);const y=(0,l.useCallback)((e=>{h(m===e?null:e)}),[m]),j=(0,l.useCallback)((()=>{f(!0)}),[]),k=(0,l.useCallback)(((e,t)=>{u(e.path===d?.path?null:{...e,refresh:t})}),[d]);return(0,i.jsxs)(re.Z,{sx:{display:"grid",gridTemplateAreas:'\n"header"\n"content"'},children:[(0,i.jsxs)(re.Z,{sx:{gridArea:"header",display:"flex",alignItems:"center"},children:[(0,i.jsx)(Ve.Z,{as:"h4",sx:{fontSize:"var(--text-title-size-small)",lineHeight:"var(--text-title-lineHeight-medium)",fontWeight:"var(--text-title-weight-medium)",flex:"1 1 auto"},children:"Storage Browser"}),(0,i.jsx)(re.Z,{children:(0,i.jsx)(Ue.QL,{label:"Upload a file",multiple:!0,upload:b})})]}),a?(0,i.jsx)(re.Z,{sx:{gridArea:"content",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"40px",height:"100vh"},children:(0,i.jsx)(Te.Z,{})}):(0,i.jsx)(re.Z,{sx:{gridArea:"content"},children:r?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)($e.L,{children:r?.map((n=>(n.fileType,"directory"===n.type?(0,i.jsx)(Ke,{item:n,contents:e,current:d,documentRegistry:t,onContextMenu:y,onSelect:k},n.name):(0,i.jsx)(He,{item:n,current:d?.path===n.path,onSelect:e=>{k(e,v)},onContextMenu:y},n.name))))}),(0,i.jsx)(ye.P,{anchorRef:m??void 0,open:null!==m?.current,onOpenChange:()=>{h(null)},children:(0,i.jsx)(ye.P.Overlay,{children:(0,i.jsx)(ke.S,{children:(0,i.jsx)(ke.S.Item,{title:"Delete the active item.",onSelect:j,children:"Delete…"})})})}),p&&(0,i.jsx)(Ee.V,{title:"Confirm deletion",onClose:()=>{f(!1)},footerButtons:[{buttonType:"default",content:"Cancel",onClick:()=>{f(!1)}},{buttonType:"danger",content:"Delete",onClick:()=>{x()}}],children:`Are you sure you want to delete ${d?.path}?`})]}):(0,i.jsx)(ze.Z,{children:(0,i.jsx)(ze.Z.Heading,{children:"No contents"})})})]})}function Ke({item:e,contents:t,current:n,documentRegistry:s,onContextMenu:r,onSelect:o}){const a=(0,l.useRef)(null),[c,d]=(0,l.useState)(null),[u,m]=(0,l.useState)(!1),h=(0,l.useCallback)((()=>{m(!0),t.get(e.path).then((e=>{m(!1),d(qe(e.content,s))})).catch((()=>{m(!1)}))}),[t,e,s]),p=(0,l.useCallback)((async e=>{null===c&&e&&h()}),[c,e,t]);return(0,i.jsxs)($e.L.Item,{ref:a,id:`${e.type}-${e.name}`,onExpandedChange:p,onSelect:()=>{o(e,h)},current:e.path===n?.path,children:[(0,i.jsx)($e.L.LeadingVisual,{children:(0,i.jsx)($e.L.DirectoryIcon,{})}),(0,i.jsx)("span",{onContextMenu:t=>{t.preventDefault(),n?.path!==e.path&&o(e,h),r(a)},children:e.name}),(0,i.jsx)($e.L.SubTree,{state:u?"loading":(c?.length??-1)>=0?"done":"initial",children:c?.map((e=>"directory"===e.type?(0,i.jsx)(Ke,{item:e,contents:t,current:n,documentRegistry:s,onContextMenu:r,onSelect:o},e.name):(0,i.jsx)(He,{item:e,current:e.path===n?.path,onSelect:e=>o(e,h),onContextMenu:r},e.name)))})]})}function He({item:e,current:t,onSelect:n,onContextMenu:s}){const r=(0,l.useRef)(null),o=e.fileType?.icon;return(0,i.jsxs)($e.L.Item,{ref:r,id:`${e.type}-${e.name}`,current:t,onSelect:()=>{n(e)},children:[(0,i.jsx)($e.L.LeadingVisual,{children:o?(0,i.jsx)(o.react,{tag:"span"}):(0,i.jsx)(ee.aAW,{})}),(0,i.jsx)("span",{onContextMenu:o=>{o.preventDefault(),t||n(e),s(r)},children:e.name})]},e.name)}function qe(e,t){const n=e.map((e=>({...e,fileType:t?.getFileTypeForModel(e)})));return n.sort(((e,t)=>"directory"===e.type&&"directory"!==t.type?-1:"directory"!==e.type&&"directory"===t.type?1:e.name.localeCompare(t.name))),n}var Ge=n(25255),We=n(85730),Je=n(68495),Ye=n(45741),Qe=n(96172),Xe=n(89439);function et(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class tt extends Qe.zz{constructor(e){super(),et(this,"_rows",void 0),et(this,"_mimeType",void 0),this._mimeType=e.mimeType,this._rows=[]}renderModel(e){const t=e.data[this._mimeType].split("\n").map((e=>e.split(";")));return this._rows=t,Promise.resolve()}render(){return 0===(this._rows.length>0?this._rows[0].length:0)?(0,i.jsx)("div",{children:"No data found!"}):(0,i.jsx)(Xe.f6,{children:this._rows.map((e=>(0,i.jsx)(re.Z,{mt:3,children:e})))})}}const nt={safe:!0,mimeTypes:["application/vnd.datalayer.csv"],createRenderer:e=>new tt(e)};var st=n(31319),rt=n(47015),ot=n(73075),it=n(40668);const at=(0,ot.M)(((e,t)=>({datasources:[],updateDatasources:t=>e((e=>({datasources:t})))})));function lt(e){return(0,it.oR)(at,e)}var ct=n(36283),dt=n(19686);function ut(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class mt{constructor(e){ut(this,"iamProvider","linkedin"),ut(this,"urn",void 0),ut(this,"id",void 0),this.urn=e;const t=e.split(":");this.id=t[3]}getURL(){return`https://www.linkedin.com/feed/update/${this.urn}`}}var ht=n(40303);const pt=e=>{const{screenCapture:t}=(0,ct.E_)(),{enqueueToast:n}=(0,Me.p)(),{user:s,iamProvidersAuthorizationURL:r,getIAMProviderAccessToken:o}=(0,rt.eP)(),{getLinkedinProfile:a,postLinkedinShareWithUpload:c}=(0,Ye.Y)(),{showBackdrop:d,hideBackdrop:u}=(0,ct.E_)(),[m,h]=(0,l.useState)(),[p,f]=(0,l.useState)(""),[g,x]=(0,l.useState)({shareText:void 0}),[v,b]=(0,l.useState)({shareText:void 0});return(0,l.useEffect)((()=>{b({...v,shareText:void 0===g.shareText?void 0:g.shareText.length>2&&g.shareText.length<1e3})}),[g]),(0,l.useEffect)((()=>{if(s){const e=o(s,"linkedin");e&&a(e).then((e=>{h(e)}))}}),[s]),(0,i.jsx)(i.Fragment,{children:r[ht.$.LinkedIn.name]?m&&(0,i.jsx)(re.Z,{display:"flex",children:(0,i.jsxs)(re.Z,{ml:3,sx:{width:"100%"},children:[(0,i.jsx)(re.Z,{children:(0,i.jsxs)(le.Z,{required:!0,children:[(0,i.jsx)(le.Z.Label,{children:"Tell something nice"}),(0,i.jsx)(de.ZP,{block:!0,value:g.shareText,onChange:e=>{x((t=>({...t,shareText:e.target.value})))},rows:3}),!1===v.shareText&&(0,i.jsx)(le.Z.Validation,{variant:"error",children:"Text must have more than 2 characters and less than 1000."})]})}),(0,i.jsxs)(re.Z,{mt:3,children:[(0,i.jsx)(oe.r,{disabled:!v.shareText||!t,leadingVisual:dt.Z,onClick:()=>{if(s&&m&&t){d("Posting on LinkedIn.");const e=o(s,"linkedin");c(m,g.shareText,t,e).then((e=>{if(e.success){const t=e.restli;if(t){const e=new mt(t).getURL();return n("Your post is shared on LinkedIn.",{variant:"success"}),void f(e)}}n("Sorry, we were not able to share your content on LinkedIn...",{variant:"error"})})).finally((()=>{u()}))}},children:"Share on LinkedIn"}),p&&(0,i.jsx)(ae.Z,{href:p,target:"_blank",children:p})]})]})}):(0,i.jsx)(Ne.Z,{variant:"warning",children:"This deployment is not configured for LinkedIn integration."})})};var ft=n(59725);const gt={small:16,medium:32,large:64};function xt({title:e,titleId:t,size:n,...s},r){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 72 72",fill:"currentColor","aria-hidden":"true",ref:r,width:n?"string"==typeof n?gt[n]:n:"16px","aria-labelledby":t},s),e?l.createElement("title",{id:t},e):null,l.createElement("circle",{cx:36.146,cy:36.428,r:22.543,fill:"#ea5a47"}),l.createElement("path",{fill:"#d22f27",d:"M52.524 20.931a22.544 22.544 0 01-36.242 26.145A22.542 22.542 0 1052.524 20.93z"}),l.createElement("path",{fill:"#f1b31c",d:"M52.794 22.755c7.674-.926 13.138-.024 14.191 2.849C68.825 30.622 56.51 39.754 39.478 46S7.146 53.242 5.306 48.224c-1.07-2.919 2.647-7.228 9.296-11.552l.076 1.553c-2.509 2.253-3.714 4.341-3.138 5.913 1.434 3.909 13.352 3.133 26.62-1.733S61.02 30.426 59.588 26.517c-.553-1.507-2.665-2.318-5.812-2.466z"}),l.createElement("g",{fill:"none",stroke:"#000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2},l.createElement("path",{d:"M17.156 46.594a21.539 21.539 0 1138.77-18.688M57.677 37.164a21.555 21.555 0 01-34.892 16.164"}),l.createElement("path",{d:"M52.794 22.755c7.674-.926 13.138-.024 14.191 2.849C68.825 30.622 56.51 39.754 39.478 46S7.146 53.242 5.306 48.224c-1.07-2.919 2.647-7.228 9.296-11.552"}),l.createElement("path",{d:"M53.776 24.05c3.147.15 5.259.96 5.811 2.467 1.434 3.91-8.16 11.023-21.428 15.888s-25.185 5.642-26.619 1.733c-.576-1.572.63-3.66 3.138-5.913"})))}const vt=l.forwardRef(xt);var bt=n(21916);const yt=(0,ot.M)((e=>({agents:[],addAgent:t=>e((e=>e.agents.includes(t)?{}:{agents:e.agents.concat([t])}))})));var jt=n(49813);function kt(e){const{agents:t,addAgent:n}=(0,it.oR)(yt,x),{createAiAgents:s}=(()=>{const{requestRun:e}=(0,bt.S)(),{configuration:t}=(0,st.Ae)();return{createAiAgents:(n,s,r,o,i="api/ai-agents/v1")=>e({url:`${t.aiagentsRunUrl}/${i}/agents`,method:"POST",body:{room_id:n,runtime:{ingress:s,token:r,kernel_id:o}}})}})(),{cell:r,extensionProps:o}=e,{notebookId:a}=o,[c,d]=(0,l.useState)(!1),[u,m]=(0,l.useState)(null),[h,p]=(0,l.useState)({prompt:""}),[f,g]=(0,l.useState)({prompt:void 0});var x;(0,l.useEffect)((()=>{const e=(e,t)=>{if("datalayer"==t.key&&u)for(const e of r.model.sharedModel.getMetadata("datalayer")?.ai?.messages??[])if(e.parent_id===u){m(null);break}};return r.model.sharedModel.metadataChanged.connect(e),()=>{r.model.sharedModel.metadataChanged.disconnect(e)}}),[r,u]),(0,l.useEffect)((()=>{u||d(!1)}),[u]),(0,l.useEffect)((()=>{g({...f,prompt:void 0===h.prompt?void 0:h.prompt.length>0})}),[h]);const v=(0,l.useCallback)((async()=>{const e=o.panel.context.sessionContext.session?.kernel,i=e?.serverSettings,l=e?.id;t.find((e=>e.documentId==a&&e.runtimeId==l))||(await s(a,i?.baseUrl,i?.token,l,"api/ai-agents/v1"),n({documentId:a,runtimeId:l}));const c=(0,jt.A)();!function(e,t,n){const s=e.model.getMetadata("datalayer")??{},r=s.ai??{prompts:[],messages:[]},o=r.prompts??[];o.push({id:t,prompt:n,username:void 0,timestamp:Date.now()}),r.prompts=o,s.ai=r,e.model.setMetadata("datalayer",s)}(r,c,h.prompt),m(c)}),[t,r,o.panel.context.sessionContext.session?.kernel,h.prompt,a,s]),b=(0,l.useCallback)((e=>{"Enter"===e.key&&v()}),[v]);return(0,i.jsx)(Xe.f6,{children:(0,i.jsx)(re.Z,{display:"flex",style:{justifyContent:"right"},children:(0,i.jsx)(re.Z,{className:"dla-cell-ai-agent-button",children:(0,i.jsxs)(ye.P,{open:c,onOpenChange:e=>d(e),children:[(0,i.jsx)(ye.P.Anchor,{id:"custom-anchor-id",children:(0,i.jsx)(ft.h,{icon:ee.uoo,variant:"invisible","aria-label":"AI Agents menu"})}),(0,i.jsx)(ye.P.Overlay,{width:"large",children:(0,i.jsxs)(re.Z,{as:"form",m:3,children:[(0,i.jsxs)(le.Z,{children:[(0,i.jsx)(le.Z.Label,{visuallyHidden:!0}),(0,i.jsx)(de.ZP,{block:!0,value:h.prompt,onChange:e=>{p((t=>({...t,prompt:e.target.value})))},disabled:!!u,onKeyDown:b})]}),(0,i.jsxs)(re.Z,{sx:{display:"flex",width:"100%",gap:"2px"},children:[(0,i.jsx)(re.Z,{flexGrow:1}),(0,i.jsx)(oe.r,{onClick:e=>d(!1),variant:"default",children:"Cancel"}),(0,i.jsx)(oe.r,{leadingVisual:vt,onClick:v,disabled:!f.prompt||!!u,variant:"primary",children:u?(0,i.jsx)(Te.Z,{size:"small"}):"Ask Joyvan"})]})]})})]})})})})}const wt=e=>{const{cell:t}=e,{datasources:n}=lt(),[s,r]=(0,l.useState)();(0,l.useEffect)((()=>{const e=(e,t)=>{if("datalayer"==(t?.key??"datalayer")){const t=(e=>{const t=e.getMetadata("datalayer");if(t){const e=t.datasource;if(e)return e.id}})(e);if(t)for(const e of n)if(t===e.id){r(t);break}}};return e(t.model),t.model.metadataChanged.connect(e),()=>{t.model.metadataChanged.disconnect(e)}}),[t,n]);const o=e=>{const n=t.model.getMetadata("datalayer");e?(t.model.setMetadata("datalayer",{...n,sql:!0,datasource:{id:e.id,variant:e.variant,name:e.name,description:e.description,database:e.database,outputBucket:e.outputBucket,destinationVar:"df"}}),r(e.id),t.editor.model.mimeType=B.uU):(t.model.setMetadata("datalayer",{...n,sql:!1,datasource:{}}),r(void 0),t.editor.model.mimeType=B.Og)};return(0,i.jsx)(Xe.f6,{children:(0,i.jsx)(re.Z,{display:"flex",style:{justifyContent:"right"},children:(0,i.jsx)(re.Z,{className:"dla-cell-datasource-button",children:(0,i.jsxs)(ye.P,{children:[(0,i.jsx)(ye.P.Anchor,{id:"custom-anchor-id",children:(0,i.jsx)(ft.h,{icon:ee.VHe,variant:"invisible","aria-label":"Open Datasources menu"})}),(0,i.jsx)(ye.P.Overlay,{width:"medium",children:(0,i.jsx)(ke.S,{selectionVariant:"single",showDividers:!0,children:(0,i.jsxs)(ke.S.Group,{children:[(0,i.jsx)(ke.S.GroupHeading,{children:"Datasources"}),0===n.length&&(0,i.jsxs)(ke.S.Item,{onSelect:()=>{},children:["No Datasource available",(0,i.jsx)(ke.S.Description,{variant:"block",children:"Create a new Datasource to connect your cell."})]}),n.map((e=>(0,i.jsxs)(ke.S.Item,{onSelect:()=>o(e),selected:e.id===s,children:[e.name,(0,i.jsx)(ke.S.Description,{variant:"block",children:e.description})]},e.id))),(0,i.jsx)(ke.S.Divider,{}),(0,i.jsx)(ke.S.Item,{children:(0,i.jsxs)(le.Z,{children:[(0,i.jsx)(le.Z.Label,{children:"Output Dataframe"}),(0,i.jsx)(ce.Z,{size:"small",value:"df",disabled:!0})]})}),(0,i.jsx)(ke.S.Divider,{}),(0,i.jsx)(ke.S.Item,{variant:"danger",onSelect:()=>o(void 0),children:"None"})]})})})]})})})})};function Ct(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const St="dla-CellToolbar-Container";class Pt extends Qe.zz{constructor(e,t){super(),Ct(this,"_cell",void 0),Ct(this,"_props",void 0),this._cell=e,this._props=t,this.addClass(St)}render(){return(0,i.jsxs)(re.Z,{display:"flex",children:[(0,i.jsx)(re.Z,{flexGrow:1}),(0,i.jsxs)(ue.VA,{initialEntries:["/"],children:[(0,i.jsx)(ue.Z5,{children:(0,i.jsx)(ue.AW,{path:"*",element:(0,i.jsx)(kt,{cell:this._cell,extensionProps:this._props})})}),(0,i.jsx)(wt,{cell:this._cell,extensionProps:this._props})]})]})}}function _t(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Zt extends R.$L{constructor(e,t){super(),_t(this,"_panel",void 0),_t(this,"_props",void 0),this._panel=e,this._props=t,this.updateConnectedCell=this.updateConnectedCell.bind(this);const n=()=>{const e=this._panel.content.model?.cells;if(e){e.changed.connect(this.updateConnectedCell);for(let t=0;t<e.length;++t)this._registerCellChanges(e.get(t))}};n(),this._panel.content.modelChanged.connect((()=>{n()}))}updateConnectedCell(e,t){t.oldValues.forEach(this._deregisterCellChanges.bind(this)),t.newValues.forEach(this._registerCellChanges.bind(this))}_deregisterCellChanges(e){}_registerCellChanges(e){const t=this._getCodeCell(e);t?(t.displayChanged.connect((()=>{this._updateCodeCell(t)})),t.inViewportChanged.connect((()=>{this._updateCodeCell(t)})),this._updateCodeCell(t)):"code"===e.type&&console.error(`Could not find code cell for model: ${e}`)}_getCodeCell(e){if("code"===e.type){const t=this._panel.content.widgets.find((t=>t.model===e));return t}return null}_updateCodeCell(e){if(e.inputArea){const t=e.layout;if(t){const n=t;n.widgets[1].hasClass(St)||n.insertWidget(1,new Pt(e,this._props))}}}}class Tt{constructor(){var e,t,n;e=this,n=void 0,(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t="_props"))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}init(e){this._props=e}createNew(e,t){new Zt(e,this._props)}get component(){return null}}var Dt=n(65942);const Nt=new s.P_;function Et(){const{notebookId:e}=(0,ue.UO)();if(!e)return(0,i.jsx)(i.Fragment,{});const t=(0,We.a)(),s=(0,te.N)(),a=(0,Je.s)(),{configuration:c}=(0,st.Ae)(),{credits:d,token:u}=(0,rt.eP)(),{configuration:m,multiServiceManager:h,jupyterLabAdapter:p,remoteKernels:f}=(0,Ce.zG)(),[g,x]=(0,l.useState)(Nt),[v,b]=(0,l.useState)(void 0),[y,j]=(0,l.useState)(),[k,w]=(0,l.useState)(!1),[C,S]=(0,l.useState)([]),[P,_]=(0,l.useState)(),[Z,T]=(0,l.useState)(!1),[N,E]=(0,l.useState)(!0),[M,R]=(0,l.useState)(""),{updateDatasources:I}=lt(),{enqueueToast:L,trackAsyncTask:A}=(0,Me.p)(),{selectNotebookModel:V,reset:$}=(0,r.qL)(),{hideBackdrop:z,screenCapture:F,setItem:U,setScreenCapture:O,showBackdrop:B,showScreenshot:K,space:H,triggerItemsRefresh:q}=(0,ct.E_)(),{cloneNotebook:G,getDatasources:W,getNotebook:J,refreshDatasources:Y,refreshNotebook:me,updateNotebook:fe,updateNotebookModel:ge}=(0,Ye.Y)(),[xe,ve]=(0,l.useState)(null),[be,ye]=(0,l.useState)(),[je,ke]=(0,l.useState)(),[we,Se]=(0,l.useState)({name:"",description:""}),[Ze,Te]=(0,l.useState)({name:void 0,description:void 0}),[De,Ne]=(0,l.useState)(null),Ee=(0,l.useMemo)((()=>({baseURL:c.spacerRunUrl,token:u,roomName:e,type:"datalayer"})),[c.spacerRunUrl,e,u]),Le=(0,l.useMemo)((()=>new D.H),[]),Ve=(0,l.useMemo)((()=>[new Tt]),[]),$e=(0,l.useMemo)((()=>[nt]),[]);(0,l.useEffect)((()=>(B(),me(e).then((t=>{if(z(),t.success){const t=J(e);t?(ye(t),ke(t.nbformat),U(t),Se({name:t.name,description:t.description})):a("/")}else L(t.message,{variant:"error"})})).finally((()=>{z()})),()=>{g.dispose(),ye(void 0),$(),U(void 0)})),[e]),(0,l.useEffect)((()=>{Y().then((e=>{if(e.success){const e=W();I(e)}}))}),[e]),(0,l.useEffect)((()=>{Te({...Ze,name:void 0===we.name?void 0:we.name.length>2,description:void 0===we.description?void 0:we.description.length>2})}),[we]);const ze=(0,l.useCallback)((async()=>{B(),fe(e,we.name,we.description).then((e=>{e.success&&(L("The notebook is successfully updated.",{variant:"success"}),q(),ye({...be,name:we.name,description:we.description}))})).finally((()=>{z()}))}),[e,we.name,we.description,be]),Fe=(0,l.useCallback)((async({kernelDesc:s,kernelModel:r,transferState:o})=>{Ke(void 0);const i=V(e);i?.model&&ke(i.model.toJSON()),j(s);const a=s?.location;switch(R(""),a){case void 0:b(void 0),E(!0),w(!1),S([]),x(Nt);break;case"browser":if(h?.browser){if(p){if(!p.jupyterLab.hasPlugin("@jupyterlite/pyodide-kernel-extension:kernel")){const e=await Promise.all([n.e(3151),n.e(5321)]).then(n.bind(n,92136));p.jupyterLab.registerPluginModule(e)}p.jupyterLab.isPluginActivated("@jupyterlite/pyodide-kernel-extension:kernel")||await p.jupyterLab.activatePlugin("@jupyterlite/pyodide-kernel-extension:kernel")}b(void 0),E(!1),S([]),w(!0),x(h.browser)}else console.error("Unable to use browser kernel. No service manager for it.");break;case"remote":{if(!h?.remote){console.error("Unable to use a remote kernel. No service manager for it.");break}let e;if(o&&g&&g===h?.browser&&P?.kernel)try{B();let t=!0;const n=P.kernel.id,s=`pyodide-${n}`,r=(0,Ie.k)({connection:P.kernel,metadata:{filename:`${s}.data`},onUploadProgress:()=>{t&&(t=!1,(0,Re.Vq)().then((t=>{e=t.find((e=>e.name===s))})))}});if(A(r,{error:{message:e=>`Failed to save the browser kernel state. ${e}`},pending:{message:"Saving the browser kernel state…"},success:{message:()=>"Browser kernel state saved."}}),await r,!e)throw Error("Unable to find snapshot for pyodide state.");await h.browser.kernels.shutdown(n)}finally{z()}if(!r){const{name:n,displayName:o,params:i}=s,a=await(h?.remote?.kernels.startNew({name:n,kernelType:"notebook",givenName:o,creditsLimit:i?.creditsLimit??(d?.available??0)/Math.max(m.maxCellKernels-f.filter((e=>"cell"!==e.kernel_type)).length,1),capabilities:i?.capabilities,snapshot:e?.id},{username:t?.handle,handleComms:!0}));r=await h.remote.kernels.findById(a.id)}w(!1),b(r.id),E(!1);const n=h.remote.kernels.getServices(r.jupyter_pod_name);R(r.jupyter_pod_name);const i=new X.ServiceManager({contents:n?.contents,kernels:n?.kernels,kernelspecs:n?.kernelspecs,serverSettings:n?.serverSettings,sessions:n?.sessions,events:{dispose:()=>{}},terminals:{connectionFailure:{connect:()=>{}},dispose:()=>{},isAvailable:()=>!1}});if(x(i),r){const e=h?.remote?.initKernelClients.get(r.id);e&&S([e])}Ne("storage");break}}}),[m,d,p,e,h,f,g]),Ue=(0,l.useCallback)((async n=>{s({title:"Are you sure?",content:"Please confirm you want to clone this notebook in your private library."}).then((n=>{n&&(B(),G(e).then((e=>{z(),e.success&&(L(e.message,{variant:"success"}),q(),a(`/${t.handle}/library/notebooks`))})))}))}),[s,be]),Oe=(0,l.useCallback)((e=>{ve(e)}),[]),Ke=(0,l.useCallback)((e=>{_(e||void 0)}),[]),He=(0,l.useCallback)((()=>{if(!N&&xe?.cells){B("Saving the notebook...");const t=xe.toJSON();ge(e,t).then((n=>{n.success&&(L("The notebook is successfully updated.",{variant:"success"}),ye({...be,id:e,nbformat:t}))})).finally((()=>{z()}))}}),[e,xe,N]),qe=(0,l.useCallback)((()=>{Ne("storage"!==De&&g&&g!==Nt?"storage":null)}),[De,g]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(ne.m,{role:"header","aria-label":"Notebook Editor",children:[(0,i.jsxs)(ne.m.TitleArea,{variant:"subtitle",children:[(0,i.jsx)(ne.m.Title,{children:"Notebook Editor"}),(0,i.jsx)(ne.m.TrailingVisual,{children:(0,i.jsx)(se.Z,{children:"Classic"})})]}),(0,i.jsx)(ne.m.Actions,{children:be&&H&&(0,i.jsxs)(re.Z,{sx:{flex:"0 0 auto",display:"flex",alignItems:"center"},children:[h?.remote&&P&&P.kernel&&(0,i.jsx)(_e.H,{kernelId:P.kernel.id,serviceManager:h.remote,onClick:()=>{a("/runtimes")}},"credits-indicator"),(0,i.jsx)(Pe,{assignKernel:Fe,sessionConnection:P},"kernel-picker"),(0,i.jsx)(Ae,{connection:P?.kernel??void 0,multiServiceManager:h,podName:M,disabled:void 0===y?.location,children:"Snapshots"}),(0,i.jsx)(oe.r,{title:"Browse content on the Remote Runtime",variant:"invisible",size:"small",disabled:!g||g===Nt,leadingVisual:()=>(0,i.jsx)(pe.Pl,{type:"content"}),onClick:qe,children:"Storage"},"content"),(0,i.jsx)(Ge.Z,{commandRegistry:Le,kernelDesc:y,save:He,sessionConnection:P},"toolbar"),(0,i.jsx)(oe.r,{variant:"invisible",size:"small",leadingVisual:ee.jcu,onClick:Ue,children:"Clone"},"clone"),(0,i.jsx)(oe.r,{title:"Capture screen",variant:"invisible",size:"small",leadingVisual:()=>(0,i.jsx)(ee.bOM,{}),onClick:()=>{K()},children:"Capture"},"capture-screen"),(0,i.jsx)(oe.r,{title:"Share",variant:"invisible",size:"small",leadingVisual:()=>(0,i.jsx)(pe.Pl,{type:"share"}),onClick:e=>T(!Z),children:"Share"},"share"),(0,i.jsx)(oe.r,{variant:"invisible",size:"small",leadingVisual:()=>(0,i.jsx)(pe.Pl,{type:"page"}),onClick:t=>a(`/new/page/notebook/${e}`),children:"Publish"},"public"),(0,i.jsx)(oe.r,{variant:"invisible",size:"small",leadingVisual:ee.UG6,onClick:e=>{Ne("properties"===De?null:"properties")},children:"Properties"},"properties")]})})]}),(0,i.jsxs)(ie.jw,{children:[(0,i.jsxs)(ie.jw.Content,{"aria-label":"Notebook Editor",width:"full",padding:"none",children:[F&&(0,i.jsx)(re.Z,{mt:3,children:(0,i.jsxs)(re.Z,{display:"flex",children:[(0,i.jsx)(re.Z,{children:(0,i.jsx)("img",{src:F})}),(0,i.jsx)(re.Z,{children:(0,i.jsx)(ae.Z,{href:"javascript: return false;",onClick:e=>O(void 0),children:(0,i.jsx)(ee.b0D,{})})})]})}),Z&&(0,i.jsx)(re.Z,{sx:{flexGrow:1},children:(0,i.jsx)(pt,{})}),je&&(void 0===y?.location?(0,i.jsx)(re.Z,{sx:{"& .jp-Cell":{marginTop:30}},children:(0,i.jsx)(o.A,{nbformat:je,outputs:!0})}):(0,i.jsx)(re.Z,{sx:{"& .jp-MainAreaWidget":{marginTop:-32},"& .jp-WindowedPanel":{margin:0},"& .jp-WindowedPanel-viewport":{padding:0}},children:(0,i.jsx)(Q,{CellSidebar:Dt.I,cellSidebarMargin:30,commandRegistry:Le,extensions:Ve,height:"calc(100vh - 150px)",collaborationServer:Ee,id:e,maxHeight:"calc(100vh - 150px)",nbformat:je,nbgrader:!1,onNotebookModelChanged:Oe,onSessionConnection:Ke,startDefaultKernel:k,readonly:N,renderers:$e,kernelId:v,serviceManager:g})}))]}),null!==De&&(0,i.jsx)(ie.jw.Pane,{"aria-label":"storage"===De?"Remote Runtime Storage":"Notebook Properties",position:"start",children:"storage"===De&&g.contents?(0,i.jsx)(Be,{contents:g.contents,documentRegistry:p?.jupyterLab.docRegistry}):"properties"===De?(0,i.jsxs)(re.Z,{as:"form",sx:{label:{marginTop:2}},children:[(0,i.jsxs)(le.Z,{children:[(0,i.jsx)(le.Z.Label,{children:"Name"}),(0,i.jsx)(ce.Z,{block:!0,value:we.name,onChange:e=>{Se((t=>({...t,name:e.target.value})))}}),!1===Ze.name&&(0,i.jsx)(le.Z.Validation,{variant:"error",children:"Name must have more than 2 characters."})]}),(0,i.jsxs)(le.Z,{children:[(0,i.jsx)(le.Z.Label,{children:"Description"}),(0,i.jsx)(de.ZP,{block:!0,value:we.description,onChange:e=>{Se((t=>({...t,description:e.target.value})))}}),!1===Ze.description&&(0,i.jsx)(le.Z.Validation,{variant:"error",children:"Description must have more than 2 characters."})]}),(0,i.jsx)(le.Z,{children:(0,i.jsx)(oe.r,{variant:"primary",disabled:!Ze.name||!Ze.description,sx:{marginTop:2},onClick:ze,children:"Update Notebook Properties"})}),(0,i.jsx)(re.Z,{mt:3}),(0,i.jsx)(he,{variant:"default",data:je,fileName:`notebook-${e}`,extension:"ipynb"})]}):(0,i.jsx)(i.Fragment,{})})]})]})}const Mt=Et},65942:(e,t,n)=>{n.d(t,{I:()=>d});var s=n(16909),r=n(82176),o=n(59725),i=n(43275),a=n(46523),l=n(30540),c=n(47011);const d=e=>{const{notebookId:t,cellNodeId:n}=e,d=(0,a.qL)(),[u,m]=(0,s.useState)(!1),h=d.selectActiveCell(t),p=h?.layout;if(p){const e=p.widgets[0];e?.node.id===n&&(u||m(!0)),e?.node.id!==n&&u&&m(!1)}return u&&h?(0,c.jsxs)(r.Z,{className:l.UI,sx:{"& p":{marginBottom:"0 !important"}},children:[(0,c.jsx)(r.Z,{children:(0,c.jsx)(o.h,{size:"small",color:"secondary","aria-label":"Run cell",title:"Run cell",onClick:e=>{e.preventDefault(),d.run(t)},icon:i.o1U,variant:"invisible"})}),(0,c.jsx)(r.Z,{children:(0,c.jsx)(o.h,{size:"small",color:"secondary","aria-label":"Add code cell above",title:"Add code cell above",onClick:e=>{e.preventDefault(),d.insertAbove({id:t,cellType:"code"})},icon:i.g8U,variant:"invisible"})}),(0,c.jsx)(r.Z,{children:(0,c.jsx)(o.h,{size:"small",color:"secondary","aria-label":"Add markdown cell above",title:"Add markdown cell above",onClick:e=>{e.preventDefault(),d.insertAbove({id:t,cellType:"markdown"})},icon:i.g8U,variant:"invisible"})}),(0,c.jsx)(r.Z,{children:"code"===h.model.type?(0,c.jsx)(o.h,{"aria-label":"Convert to markdow cell",title:"Convert to markdow cell",icon:i.Ps4,size:"small",variant:"invisible",onClick:e=>{e.preventDefault(),d.changeCellType({id:t,cellType:"markdown"})}}):(0,c.jsx)(o.h,{"aria-label":"Convert to code cell",title:"Convert to code cell",icon:i.Ps4,variant:"invisible",size:"small",onClick:e=>{e.preventDefault(),d.changeCellType({id:t,cellType:"code"})}})}),(0,c.jsx)(r.Z,{children:(0,c.jsx)(o.h,{size:"small",color:"secondary","aria-label":"Add markdown cell below",title:"Add markdown cell below",onClick:e=>{e.preventDefault(),d.insertBelow({id:t,cellType:"markdown"})},icon:i.v4q,variant:"invisible"})}),(0,c.jsx)(r.Z,{children:(0,c.jsx)(o.h,{size:"small",color:"secondary","aria-label":"Add code cell above",title:"Add code cell above",onClick:e=>{e.preventDefault(),d.insertBelow({id:t,cellType:"code"})},icon:i.v4q,variant:"invisible"})}),(0,c.jsx)(r.Z,{children:(0,c.jsx)(o.h,{size:"small",color:"error","aria-label":"Delete cell",title:"Delete cell",onClick:e=>{e.preventDefault(),d.delete(t)},icon:i.b0D,variant:"invisible"})})]}):(0,c.jsx)(c.Fragment,{})}},63234:(e,t,n)=>{n.d(t,{Z:()=>i});var s=n(16909);const r={small:16,medium:32,large:64};function o({title:e,titleId:t,size:n,...o},i){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 72 72",fill:"currentColor","aria-hidden":"true",ref:i,width:n?"string"==typeof n?r[n]:n:"16px","aria-labelledby":t},o),e?s.createElement("title",{id:t},e):null,s.createElement("path",{fill:"#D0CFCE",d:"M31.853 29.874V12.521H42.15v17.36h.048l4.051.002h13.357V40.18H46.256l-4.107-.003v18.675H31.853V40.17h-.1l-3.817-.002H14V29.87h13.933l3.836.003z"}),s.createElement("path",{fill:"none",stroke:"#000",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:10,strokeWidth:2,d:"M31.853 29.874V12.521H42.15v17.36h.048l4.051.002h13.357V40.18H46.256l-4.107-.003v18.675H31.853V40.17h-.1l-3.817-.002H14V29.87h13.933l3.836.003z"}))}const i=s.forwardRef(o)}}]);
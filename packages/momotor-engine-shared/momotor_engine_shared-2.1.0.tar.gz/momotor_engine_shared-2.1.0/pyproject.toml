[build-system]
requires = ["setuptools", "setuptools-scm"]
build-backend = "setuptools.build_meta"

[project]
name = "momotor-engine-shared"
authors = [
    { name = "Erik Scheffers", email = "e.t.j.scheffers@tue.nl" }
]
description = "Momotor Engine shared code"
requires-python = ">=3.9"
dynamic = ["version", "readme"]
license = { text="GNU Lesser General Public License v3 (LGPLv3)" }
classifiers = [
    "Development Status :: 5 - Production/Stable",
    "Intended Audience :: Developers",
    "Programming Language :: Python",
    "Programming Language :: Python :: 3.9",
    "Programming Language :: Python :: 3.10",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
    "Programming Language :: Python :: 3 :: Only"
]
dependencies = [
    'aiorwlock',
    'typing-extensions~=4.0; python_version < "3.11"',
]

[project.optional-dependencies]
test = [
    'pytest~=8.1',
    'pytest-cov'
]
docs = [
    'momotor-engine-shared[test]',
    'Sphinx',
    'sphinx-autodoc-typehints!=1.14.0',
    'furo',
]
dev = [
    'momotor-engine-shared[docs]',
    'docutils-stubs',
]
build = [
    'momotor-engine-shared[dev]',
    'setuptools',
    'setuptools-scm',
    'build[virtualenv]',
    'python-semantic-release~=9.0',
]

[project.urls]
Homepage = "https://momotor.org"
Documentation = "https://momotor.org/doc/engine/momotor-engine-shared/"
Repository = "https://gitlab.tue.nl/momotor/engine-py3/momotor-engine-shared/"
Tracker = 'https://gitlab.tue.nl/momotor/engine-py3/momotor-engine-shared/issues'

[tool.setuptools]
include-package-data = true

[tool.setuptools.packages.find]
where = ["src"]
include = ["momotor.*"]

[tool.setuptools.dynamic]
readme = { file = ["README.md"], content-type = "text/markdown" }

[tool.setuptools_scm]

[tool.pytest.ini_options]
norecursedirs = [".git", "editables"]
pythonpath = "src"
addopts = "--cov=src -p no:asyncio -p no:django -p no:pytest_doctestplus"
xfail_strict = true

[tool.semantic_release]
version_toml = ["version.toml:semantic_release.version"]
commit_message = 'chore: bump version number'

[tool.semantic_release.changelog]
exclude_commit_patterns = ["^Merge branch ", "^ci\\s*[:(]", "^build\\s*[:(]"]

[tool.semantic_release.release]
upload_to_vcs_release = false

[tool.semantic_release.remote]
type = "gitlab"

[tool.semantic_release.branches.master]
match = "master"
prerelease = false

[tool.semantic_release.branches.other]
match = ".*"
prerelease = true
prerelease-token = "rc"

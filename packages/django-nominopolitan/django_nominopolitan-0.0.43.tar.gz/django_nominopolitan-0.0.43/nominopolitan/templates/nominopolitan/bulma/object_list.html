{% extends base_template_path %}
{% load partials %}
{% load nominopolitan %}

{% block content %}
    {% partial content %}
{% endblock %}

{% partialdef content %}
    <title id="header_title">{{header_title}}</title>
    <div class="is-flex is-flex-direction-column m-2 p-2">
        <h1 class="is-flex-grow-1 title is-4">{{ object_verbose_name_plural|capfirst }}</h1>
        {% if create_view_url %}
            <div class="mt-2">
                {% if use_htmx and htmx_target %}
                <a class="button is-primary" href="{{ create_view_url }}"
                hx-get="{{ create_view_url }}" hx-target="{{htmx_target}}" hx-replace-url="true" hx-push-url="true"
                >
                    Add a new {{ object_verbose_name }}
                </a>
                {% else %}
                <a class="button is-primary" href="{{ create_view_url }}">
                    Add a new {{ object_verbose_name }}
                </a>
                {% endif %}
            </div>
        {% endif %}
        {% if object_list %}
            {% object_list object_list view %}
            {% partial pagination %}
        {% else %}
            <p class="mt-4">There are no {{ object_verbose_name_plural }}. Create one now?</p>
        {% endif %}
    </div>
    <hr>
    <div id="crud_target"></div>

    {# in-built modal with target modalContent. Partial inclusion does not seem to work when imported #}
    <div x-data="{ nominopolitanModalOpen: false }" id="nominopolitanBaseModal" 
        {% if use_modal %}
            @show-nominopolitan-modal.window="nominopolitanModalOpen = true"
        {% endif %}>
        <div class="modal" :class="{ 'is-active': nominopolitanModalOpen }">
            <div class="modal-background" @click="nominopolitanModalOpen = false"></div>
            <div class="modal-content">
                <div class="box" style="position: relative;">
                    <button class="delete is-large" aria-label="close" @click="nominopolitanModalOpen = false"
                        style="position: absolute; top: 0.5rem; right: 0.5rem;"></button>
                    <div id="nominopolitanModalContent" 
                    {% if use_modal %} 
                        hx-trigger="htmx:afterSwap"
                        hx-on::after-swap="window.dispatchEvent(new Event('show-nominopolitan-modal'))" 
                    {% endif %}>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endpartialdef content %}

{% partialdef pagination %}
    {% if is_paginated %}
    <nav class="pagination is-centered is-small is-rounded mt-4" role="navigation" aria-label="pagination">
        {% if page_obj.has_previous %}
        <a class="pagination-previous" href="?page={{ page_obj.previous_page_number }}"
        {% if use_htmx and original_target %}
            hx-get="?page={{ page_obj.previous_page_number }}" hx-target="{{original_target}}" 
            hx-replace-url="true" hx-push-url="true"
        {% endif %}
        >Previous</a>
        {% endif %}
    
        {% if page_obj.has_next %}
        <a class="pagination-next" href="?page={{ page_obj.next_page_number }}"
        {% if use_htmx and original_target %}
            hx-get="?page={{ page_obj.next_page_number }}" hx-target="{{original_target}}" 
            hx-replace-url="true" hx-push-url="true"
        {% endif %}
        >Next
        </a>
        {% endif %}
        <ul class="pagination-list">
            {% get_proper_elided_page_range paginator page_obj.number as page_range %}
            {% for i in page_range %}
            {% if i == "..." %}
            <li><span class="pagination-ellipsis">&hellip;</span></li>
            {% else %}
            <li>
                <a class="pagination-link {% if page_obj.number == i %}is-current{% endif %}" href="?page={{ i }}"
                    aria-label="Page {{ i }}" {% if use_htmx and original_target %} hx-get="?page={{ i }}"
                    hx-target="{{original_target}}" hx-replace-url="true" hx-push-url="true" {% endif %}>{{ i }}
                </a>
            </li>
            {% endif %}
            {% endfor %}
        </ul>
    </nav>
    {% endif %}
{% endpartialdef pagination %}